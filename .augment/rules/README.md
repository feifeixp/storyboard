# 分镜脚本生成核心规则库

本文件夹集中存放所有分镜脚本生成的**核心规则文件**。

**设计原则**：
- ✅ 只保留强制性约束和核心术语映射
- ✅ 保持简洁，总大小约50KB（符合AI上下文限制）
- ✅ 详细理论文档已移至 `docs/rules/` 目录
- ✅ 通过引用链接连接核心规则和详细文档

**最后更新**: 2024-12-28

---

## 📂 规则文件结构

### 规则配置文件（元规则）

| 文件 | 大小 | 作用域 | 描述 |
|------|------|--------|------|
| `README.md` | 3.9KB | 说明 | 本文件，规则库说明文档 |
| `global-rules.md` | 4.6KB | 全局 | 通用开发规范，可复制到其他项目使用 |
| `project-rules.md` | 5.1KB | 项目 | 分镜项目特定规则，仅当前项目有效 |

### 核心规则汇总

| 文件 | 大小 | 描述 |
|------|------|------|
| `核心规则汇总.md` | 24KB | **主文件**，汇总所有核心规则的精简版本 |

### 核心理论文档（保留在本目录）

| 文件 | 大小 | 描述 |
|------|------|------|
| `分镜设计连续性三原则.txt` | 5.9KB | 分镜连续性规则（基于《动画大师课》） |
| `POV镜头使用指南.md` | 4.3KB | POV镜头规则和禁用词列表 |
| `短剧漫剧剧本的核心要求.txt` | 3.1KB | 短剧剧本创作规范 |

**总大小**: 约50KB（符合≤49512字符限制）

### 详细文档（已移至 `docs/rules/` 目录）

| 文件 | 大小 | 新位置 | 描述 |
|------|------|--------|------|
| `角度规则优化总结.ini` | 14.9KB | `docs/rules/` | 角度分布规则、景别术语、视角高度、人物朝向的详细说明 |
| `提示词规范标准.ini` | 48.7KB | `docs/rules/` | AI图像生成提示词规范（完整版） |
| `视频生成提示词规范.ini` | 10.6KB | `docs/rules/` | AI视频生成提示词规范（I2V/T2V） |
| `透视知识-项目应用指南.md` | 26.3KB | `docs/rules/` | 透视应用于分镜生成的详细指南 |
| `开发日志规范说明.md` | 7.2KB | `docs/rules/` | R007规则的详细说明 |

**总大小**: 约108KB

---

## 🌍 规则作用域说明

### 全局规则（`global-rules.md`）

**适用范围**: 所有项目
**包含规则**:
- R001: 代码操作前置校验
- R002: 代码完整性约束
- R006: 规则简洁性约束
- R007: 开发日志记录规范
- G001-G004: 规则设计指南

**使用方式**:
```bash
# 在新项目中使用
mkdir -p .augment/rules
cp path/to/global-rules.md .augment/rules/
```

### 项目规则（`project-rules.md`）

**适用范围**: 仅 visionary-storyboard-studio 项目
**包含规则**:
- R008: 角度规则强制校验

**特点**:
- 与项目代码紧密耦合
- 引用项目特定文件路径
- 不适用于其他项目

---

## 🚨 重要提醒

### 修改代码前必读
在修改以下代码文件时，**必须先查阅对应的规则文件**：

1. **修改 `services/constants.ts`**
   - 查阅：`docs/rules/角度规则优化总结.ini`
   - 关键常量：DEFAULTS.ANGLE_HEIGHT, SHOT_RULES.MAX_FRONT_VIEW_SHOTS

2. **修改 `services/openrouter.ts` 的提示词**
   - 查阅：`docs/rules/角度规则优化总结.ini`, `docs/rules/提示词规范标准.ini`
   - 关键部分：角度分布规则表格

3. **修改 `prompts/chain-of-thought/stage3-shot-planning.ts`**
   - 查阅：`docs/rules/角度规则优化总结.ini`, `.augment/rules/分镜设计连续性三原则.txt`
   - 关键部分：朝向角度分布要求表格

### 防回归检查清单
在提交代码前，请确认：
- [ ] 正面镜头占比 ≤7%
- [ ] 平视镜头占比 10-15%
- [ ] 默认角度高度为"轻微仰拍"而非"平视"
- [ ] 极端角度占比 ≥15%
- [ ] 所有提示词中的角度分布规则与规则文件一致

---

## 📝 规则更新流程

1. **提出修改需求** - 说明为什么需要修改规则
2. **更新详细文档** - 修改 `docs/rules/` 中的对应文件
3. **同步核心规则汇总** - 更新 `核心规则汇总.md` 中的精简版本
4. **同步代码实现** - 修改所有相关代码文件
5. **验证一致性** - 运行测试，确保规则生效
6. **更新开发日志** - 在 `DEVELOPMENT_LOG.md` 中记录

---

## 📚 规则制定依据

所有规则基于以下理论和实践：
- **《Framed Ink》** - Marcos Mateu-Mestre 的视觉叙事理论
- **《分镜脚本设计新手手册》** - 专业分镜设计指南
- **《动画大师课》系列** - 人物透视、画幅与分镜、分镜头脚本设计
- **实际测试反馈** - 基于生成结果的持续优化

---

**创建时间**: 2024-12-26
**最后更新**: 2024-12-28
**维护人**: AI Assistant


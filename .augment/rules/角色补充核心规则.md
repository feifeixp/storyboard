---
type: "always_apply"
description: "角色补充功能的核心规则，包括剧本类型分类、优先级系统、外貌描述规范、服装设计规范"
scope: "character_supplement"
---

# 角色补充核心规则

**版本**: 1.0  
**功能**: 角色智能补充（AI Supplement）  
**作用域**: 角色补充相关代码  
**最后更新**: 2024-12-28

> ⚠️ **重要提示**：
> - 本文件包含角色补充功能的所有核心规则
> - 修改角色补充相关代码前必须查阅本文件
> - 这些规则直接影响生成的角色外貌和服装质量

---

## 🎯 核心原则（黄金法则）

### 1. 剧本类型决定美学标准（最高优先级）

**优先级系统**：
```
剧本类型 > 社会阶层 > 性格特征 > 角色定位
```

**核心逻辑**：
- 剧本类型决定整体美学标准
- 社会阶层在美学标准内选择合适的款式
- 性格和角色定位作为辅助参考

**示例**：
- "90年代女频言情重生剧" + "底层女孩" → 精致的碎花裙（极致美型类）
- "90年代农村纪实剧" + "底层女孩" → 朴素的劳动服（接地气类）

### 2. 外貌和服装严格分离

**Stage3（外貌描述）**：
- ✅ 只描述：头发、发型、眼睛、五官、肤色、身材、体态
- ❌ 不描述：衣服、裤子、裙子、鞋子、配饰

**Stage4（服装设计）**：
- ✅ 只描述：服装款式、面料、颜色、设计细节、配饰
- ❌ 不描述：身体特征

### 3. 使用影视美学词汇

**✅ 使用美学词汇**：
- 头发：富有光泽、纤长浓密、柔顺飘逸
- 眼睛：清澈明亮、深邃有神、温柔如水
- 肤色：白皙细腻、健康自然、温润如玉

**❌ 避免缺陷词汇**：
- 杂乱、凌乱、灰尘、粗糙、暗沉、憔悴、干枯、毛躁

---

## 📊 剧本类型分类标准

### 三大类型

| 类型 | 判断标准 | 美学要求 | 典型题材 |
|------|---------|---------|---------|
| 极致美型类 | 女频言情/重生/甜宠/逆袭/霸总/玛丽苏/古装仙侠/玄幻/偶像剧 | 追求完美无瑕、精致梦幻 | 《甄嬛传》《延禧攻略》《何以笙箫默》 |
| 自然真实类 | 现代都市/职场/家庭剧 | 追求真实、自然、有质感 | 《欢乐颂》《都挺好》 |
| 接地气类 | 农村/纪实/年代剧（题材明确） | 追求生活化、接地气 | 《山海情》《平凡的世界》 |

### 判断优先级

**第一优先级：题材类型**
- 女频言情/重生/甜宠/逆袭/霸总/玛丽苏 → **极致美型类**
- 古装仙侠/玄幻/偶像剧 → **极致美型类**

**第二优先级：时代背景**（仅在题材不明确时参考）
- 现代都市/职场/家庭 → 自然真实类
- 农村/纪实 → 接地气类

**示例**：
- "90年代女频言情重生剧" → **极致美型类**（题材优先）
- "90年代农村纪实剧" → 接地气类（题材明确）

---

## 👤 外貌描述规范（Stage3）

### 描述内容

**必须包含**：
- 【主体人物】：人种、性别、年龄、时代背景、头身比例
- 【外貌特征】：发型、眼睛、五官、肤色、体态（100-150字）

**严禁包含**：
- ❌ 服装描述（衣服、裤子、裙子）
- ❌ 配饰描述（首饰、鞋子、包包）

### 头身比例标准

| 角色定位 | 头身比例 | 说明 |
|---------|---------|------|
| 主角 | 8-8.5头身 | 影视剧主角标准 |
| 重要配角 | 7.5-8头身 | 影视剧演员标准 |
| 普通配角 | 7头身 | 普通人标准 |

### 美学标准选择

**极致美型类**：
- 追求完美无瑕、精致梦幻
- 使用"精致立体"、"柔和自然"、"清秀俊朗"等词汇

**自然真实类**：
- 追求真实、自然、有质感
- 使用"健康自然"、"端正大方"等词汇

**接地气类**：
- 追求生活化、朴实
- 使用"朴实自然"、"健康有力"等词汇

---

## 👗 服装设计规范（Stage4）

### 优先级系统（核心）

**第一优先级：剧本类型** ⭐⭐⭐

1. **极致美型类**：
   - ✅ 必须选择有设计感、有记忆点的款式
   - ✅ 优先选择：连衣裙、碎花裙、有刺绣/蕾丝的上衣、有设计感的裙装
   - ❌ 避免选择：纯色衬衫、普通T恤、基础款等过于朴素的款式
   - **即使角色是底层，也要选择"精致的底层"款式**

2. **自然真实类**：
   - 可以根据社会阶层选择合适的款式
   - 追求真实、自然、有质感

3. **接地气类**：
   - 可以选择朴素、实用的款式
   - 追求生活化、接地气

**第二优先级：社会阶层**（在美学标准内选择）
- 富裕 → 选择更高级的面料和工艺
- 中产 → 选择得体、有品味的款式
- 底层 → 在美学标准内选择相对简约的款式

**第三优先级：性格特征**
- 温婉 → 柔美、优雅（如碎花裙、雪纺衫）
- 英气 → 利落、简约（如小西装、直筒裤）
- 叛逆 → 个性、前卫（如皮夹克、破洞牛仔裤）

**第四优先级：角色定位**
- 主角 → 有记忆点、有设计感
- 配角 → 符合身份、不抢戏
- 反派 → 有气场、有冲击力

### 服装设计6个维度

每个服装描述必须包含以下6个维度：

1. **材质与纹理**：面料类型、质感描述
2. **版型与剪裁**：款式、剪裁方式
3. **色彩与花纹**：颜色、图案
4. **设计细节**：刺绣、蕾丝、纽扣等
5. **新旧程度**：全新、略旧、陈旧
6. **配饰搭配**：鞋子、首饰、包包

### 时代款式库（动态生成）

**不要硬编码款式库**，而是让LLM根据时代背景推理：

**思考框架**：
1. 该时代的社会经济水平如何？
2. 该时代的服装制作工艺如何？
3. 该时代的审美标准是什么？
4. 该时代的常见面料有哪些？

**示例**：
- 古装时代（唐朝、宋朝）→ 襦裙、圆领袍、半臂、褙子
- 近现代（民国、50-90年代）→ 旗袍、中山装、衬衫、牛仔裤
- 当代/未来（2020年代、科幻）→ T恤、卫衣、智能面料
- 架空/玄幻 → 道袍、法衣、战甲

---

## 🔄 增量补充逻辑

### 核心原则

**只补充缺失的信息，不重复已有内容**

### 实现方式

**Prompt层面**：
```
## 角色已有信息（请参考，避免重复）
- 外观描述：已有150字
- 已有形态数：2个
- 已有能力数：3个

⚠️ 重要原则：
1. 只补充缺失的信息
2. 数组字段：如果已有内容，只添加剧本中明确但未记录的新项
3. 字符串字段：如果已有内容但不完整，可以扩充但不要完全重写
```

**代码层面**：
```typescript
// 保留已有字段
return {
  ...character,  // 保留所有已有字段
  
  // 外观描述：已有且>=100字则保留
  appearance: character.appearance && character.appearance.length >= 100 
    ? character.appearance 
    : newAppearance,
  
  // 数组字段：保留已有内容
  forms: character.forms || [],
  abilities: character.abilities || [],
}
```

---

## 📁 相关文件清单

| 文件 | 描述 | 关键内容 |
|------|------|----------|
| `services/characterSupplement/index.ts` | 主流程控制 | 流式输出、进度回调、结果合并 |
| `services/characterSupplement/stage1-script-analysis.ts` | 剧本分析 | 剧本类型判断、角色定位分析 |
| `services/characterSupplement/stage2-visual-tags.ts` | 视觉标签设计 | 视觉标签生成 |
| `services/characterSupplement/stage3-appearance-design.ts` | 外貌描述创作 | 外貌描述生成、头身比例 |
| `services/characterSupplement/stage4-costume-design.ts` | 服装设计 | 服装款式选择、6维度描述 |
| `services/characterSupplement/types.ts` | 类型定义 | 各阶段输出类型 |
| `services/characterSupplement/utils.ts` | 工具函数 | JSON提取、验证、合并 |

---

## 🔧 修改代码前的检查清单

修改角色补充相关代码前必须确认：

- [ ] 剧本类型判断逻辑是否正确（题材优先于时代）
- [ ] 优先级系统是否正确（剧本类型 > 社会阶层 > 性格 > 角色定位）
- [ ] Stage3是否只描述身体特征，不描述服装
- [ ] Stage4是否包含6个维度的服装描述
- [ ] 增量补充逻辑是否保留已有内容
- [ ] 时代款式库是否动态生成，而非硬编码

---

**创建时间**: 2024-12-28  
**维护人**: AI Assistant  
**适用范围**: 仅角色补充功能


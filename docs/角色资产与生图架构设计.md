# è§’è‰²èµ„äº§ä¸ç”Ÿå›¾æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**ï¼šv1.0 | **çŠ¶æ€**ï¼šè®¾è®¡ç¨¿  
> **å‚è€ƒ**ï¼š`storyboard/docs/æ£€ç´¢å¢å¼º + è§’è‰²è¯­ä¹‰éª¨æ¶.ini`  
> **ç›®æ ‡**ï¼šç»Ÿä¸€æ”¯æ’‘"å‰ç«¯è§’è‰²å¡å±•ç¤º"ä¸"nano banana pro ç”Ÿå›¾"ä¸¤æ¡é“¾è·¯

---

## ä¸€ã€è®¾è®¡ç›®æ ‡

1. **ä¸€çœŸå¤šè§†å›¾**ï¼šä»¥ç»“æ„åŒ–é…ç½®ï¼ˆSkeleton + Configï¼‰ä¸ºå”¯ä¸€"çœŸç›¸"ï¼Œæ´¾ç”Ÿå‡ºä¸¤ä¸ªè§†å›¾ï¼š
   - ç»™äººçœ‹çš„ï¼šè§’è‰²å¡æ–‡æ¡ˆï¼ˆHumanDescriptionï¼‰
   - ç»™æ¨¡å‹çœ‹çš„ï¼šç”Ÿå›¾ Promptï¼ˆGenerationPromptï¼‰
2. **ä¸‰å±‚æ¸…æ™°åˆ†ç¦»**ï¼šè¯­ä¹‰å±‚ / è§†è§‰å±‚ / ç”Ÿæˆå±‚ï¼ŒèŒè´£ä¸è¶Šç•Œ
3. **å¤šå½¢æ€ç»Ÿä¸€ç®¡ç†**ï¼šåŸºç¡€å½¢æ€ï¼ˆbaselineï¼‰+ Delta ç»§æ‰¿ï¼Œ`identitySeed` ä¿è¯è·¨å½¢æ€è„¸å‹ä¸€è‡´
4. **ç”¨æˆ·é£æ ¼ä¼˜å…ˆ**ï¼šUI é¡µé¢é€‰æ‹©çš„æ¸²æŸ“é£æ ¼ä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œç³»ç»Ÿæ¨æ–­ä»…ä½œå…œåº•
5. **å¯å›æº¯ / å¯å¤ç”¨**ï¼šæ‰€æœ‰ä¸­é—´äº§ç‰©å¯ç¼–è¾‘ï¼Œç‰ˆæœ¬å¯è¿½æº¯

---

## äºŒã€æ€»ä½“æ¶æ„

```
å‰§æœ¬æ–‡æœ¬
  â†“
ã€è¯­ä¹‰å±‚ã€‘Stage1 + Stage5
  â†’ SemanticSkeletonï¼ˆè§’è‰²éª¨æ¶ JSONï¼‰
  â†“
ã€è§†è§‰å±‚ã€‘Stage2 â†’ Stage3 â†’ Stage4
  â†’ VisualConfigï¼ˆè§†è§‰ç­–ç•¥ä¸­æ¢ï¼‰
  â†’ AppearanceConfigï¼ˆå¤–è²Œç»“æ„åŒ–é…ç½®ï¼‰
  â†’ CostumeConfigï¼ˆæœè£…ç»“æ„åŒ–é…ç½®ï¼‰
  â†“
ã€ç”Ÿæˆå±‚ã€‘PromptCompiler + HumanDescriptionGenerator
  â†’ GenerationPromptï¼ˆç»™ nano banana proï¼‰
  â†’ HumanDescriptionï¼ˆç»™å‰ç«¯è§’è‰²å¡ï¼‰
  â†“
ã€å¤šå½¢æ€æ‰©å±•ã€‘ä¸‰é˜¶æ®µæ¸è¿›å¼ï¼ˆä¸é™æ•°é‡ï¼Œç”¨æˆ·ä¸»å¯¼ï¼‰
  Phase1: Stage5.5 è½»é‡æ‰«æ â†’ FormSummary[]ï¼ˆå½¢æ€æ¸…å•ï¼Œä»…å…ƒæ•°æ®ï¼‰
  Phase2: ç”¨æˆ·å®¡æŸ¥æ¸…å• â†’ é€‰æ‹©è¦ç”Ÿæˆçš„å½¢æ€
  Phase3: æŒ‰éœ€è¯¦ç»†ç”Ÿæˆ â†’ FormAsset[]ï¼ˆdelta + å®Œæ•´æè¿° + Promptï¼‰
```

### ä¸‰å±‚ä¸äº”æ­¥å¯¹ç…§

| INI å±‚ | Stage | èŒè´£ | è¾“å‡º |
|--------|-------|------|------|
| è¯­ä¹‰å±‚ | Stage1 | è§’è‰²éª¨æ¶ä¸»å¹²ï¼ˆæ—¶ä»£/æ€§æ ¼/åŠ¨æœº/åœºæ™¯ï¼‰ | SemanticSkeleton |
| è¯­ä¹‰å±‚ | Stage5 | éª¨æ¶æ‰©å±•ï¼ˆå°è¯/èƒ½åŠ›/æ¼”å˜ï¼‰ | SemanticSkeleton.facts |
| è§†è§‰å±‚ | Stage2 | è§†è§‰ç­–ç•¥ä¸­æ¢ï¼ˆæ°”è´¨/æ„å›¾/é”šç‚¹ï¼‰ | VisualConfig |
| è§†è§‰å±‚ | Stage3 | å¤–è²Œæ‰§è¡Œï¼ˆå‘å‹/äº”å®˜/ä½“æ€ï¼‰ | AppearanceConfig + æ–‡æ¡ˆ |
| è§†è§‰å±‚ | Stage4 | æœè£…æ‰§è¡Œï¼ˆ6 ç»´åº¦ï¼‰ | CostumeConfig + æ–‡æ¡ˆ |
| ç”Ÿæˆå±‚ | ç¼–è¯‘å™¨ | ç”Ÿæˆ Prompt ä¸è§’è‰²å¡æ–‡æ¡ˆ | GenerationPrompt + HumanDescription |

---

## ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„

### 3.1 SemanticSkeletonï¼ˆè¯­ä¹‰éª¨æ¶ï¼‰

> Stage1 + Stage5 è”åˆè¾“å‡ºï¼›æ˜¯æ•´æ¡é“¾è·¯çš„"å”¯ä¸€çœŸç›¸"æ ¹èŠ‚ç‚¹

```ts
interface SemanticSkeleton {
  basic: {
    era: string;          // "ä¸­å›½90å¹´ä»£" / "å¤ä»£å”æœ" / "ç°ä»£"
    gender: string;       // "ç”·" | "å¥³"
    ageGroup: string;     // "å„¿ç«¥" | "å°‘å¹´" | "é’å¹´" | "ä¸­å¹´" | "è€å¹´"
    specificAge?: number; // å¤–è²Œå¹´é¾„ï¼ˆä¿®ä»™è€…å–å¤–è²Œå¹´é¾„è€Œéå®é™…å¹´é¾„ï¼‰
    occupation?: string;
  };
  position: {
    role: 'ä¸»è§’' | 'é…è§’' | 'åæ´¾';
    socialClass: 'å¯Œè£•' | 'ä¸­äº§' | 'åº•å±‚';
  };
  personality: {
    traits: string[];          // ["åšéŸ§", "å†³ç»"]
    keyBehaviors: string[];
    motivation?: {
      wants: string;           // ğŸ†• æƒ³è¦ä»€ä¹ˆ
      fears: string;           // ğŸ†• ææƒ§ä»€ä¹ˆ
    };
  };
  scriptType: {
    category: string;          // "å¥³é¢‘è¨€æƒ…" | "éƒ½å¸‚èŒåœº" | ...
    genre: string;             // "é‡ç”Ÿç”œå® " | "çºªå®ç°å®ä¸»ä¹‰" | ...
    aestheticDirection: string;
  };
  scenes: {
    mainScene: string;
    specificScenes: string[];
    season: string;
  };
  scriptAppearance?: {         // å‰§æœ¬åŸæ–‡æ‘˜æŠ„ï¼Œä¼˜å…ˆçº§æœ€é«˜
    costume?: string;
    hair?: string;
    makeup?: string;
    other?: string;
  };
  facts?: {                    // Stage5 å¡«å……
    quote?: string;
    quoteSource?: string;
    abilities?: string[];
    identityEvolution?: string;
  };
}
```

### 3.2 VisualConfigï¼ˆè§†è§‰ç­–ç•¥ä¸­æ¢ï¼‰

> Stage2 é‡æ„åçš„è¾“å‡ºï¼›ä¸å†™å…·ä½“æ¬¾å¼ï¼Œåªå†™"è§†è§‰ç­–ç•¥"

```ts
interface VisualConfig {
  aesthetic: {
    beautyLevel: 'realistic' | 'balanced' | 'idealized';
    styleTag: string;       // "çœŸå®" | "ç¾åŒ–" | "åä¸½" | "æ—¶å°š"
  };
  temperament: {
    templates: string[];    // ["å†·æ„Ÿç¾äºº", "å°‘å¹´æ„Ÿ"]ï¼ˆæœªæ¥æ¥æ°”è´¨æ¨¡æ¿åº“ï¼‰
    explanation: string;    // ä¸ºä»€ä¹ˆé€‰è¿™ä¸ªæ°”è´¨
  };
  appearanceIntent: {
    focus: string[];        // ["çœ¼ç¥çš„åšæ¯…", "è½®å»“æ¸…æ™°åº¦"]
    avoid: string[];        // ["è¿‡åº¦ç”œç¾æ„Ÿ", "å¹¼æ€æ„Ÿ"]
  };
  costumeIntent: {
    formality: string;      // "æ—¥å¸¸æœ´ç´ " | "èŒåœºå¹²ç»ƒ" | "å…¸ç¤¼åä¸½"
    layering: string;       // "å•å±‚" | "åŒå±‚" | "å¤šå±‚"
    colorDirection: string; // "ä½é¥±å’Œä¸­æ€§è‰² + å°‘é‡ç‚¹ç¼€"
  };
  anchors?: {
    mustKeep: string[];     // ä¸å¯å˜ç‰¹å¾ï¼ˆå¦‚ç–¤ç—•ã€æ ‡å¿—é…é¥°ï¼‰
    mustAvoid: string[];    // ä¸å¯å‡ºç°ï¼ˆå¦‚è·¨æ—¶ä»£å…ƒç´ ï¼‰
  };
}
```

### 3.3 AppearanceConfigï¼ˆå¤–è²Œç»“æ„åŒ–é…ç½®ï¼‰

> Stage3 åœ¨ç°æœ‰è‡ªç„¶è¯­è¨€è¾“å‡ºåŸºç¡€ä¸Šï¼Œæ–°å¢ç»“æ„åŒ–é…ç½®ï¼›ä¾› PromptCompiler ç²¾ç¡®æ˜ å°„

```ts
interface AppearanceConfig {
  faceShape: string;      // "é¹…è›‹è„¸" | "æ–¹ä¸‹é¢Œ" | "åœ†è„¸"
  eyes: string;           // å½¢çŠ¶ + å¤§å° + ç¥æ€
  brows: string;          // çœ‰å‹ + æµ“æ·¡
  nose: string;
  lips: string;
  skin: string;           // è‚¤è‰² + è´¨æ„Ÿï¼ˆå¦‚"ç™½çš™ç»†è…»"ï¼‰
  hair: {
    style: string;        // å‘å‹ï¼ˆç¬¦åˆæ—¶ä»£èƒŒæ™¯ï¼‰
    length: string;       // "é•¿" | "ä¸­" | "çŸ­" | "æçŸ­"
    texture: string;      // å‘è´¨æè¿°
    accessories?: string; // å‘é¥°ï¼ˆå¦‚ç°ªå­ã€å‘å¸¦ï¼‰
  };
  body: {
    proportion: string;   // å¤´èº«æ¯”ï¼ˆå¦‚ "7.5å¤´èº«"ï¼‰
    bodyType: string;     // "çº¤ç»†" | "åŒ€ç§°" | "å¾®èƒ–" | "å¼ºå£®"
    posture: string;      // ä½“æ€ï¼ˆå¦‚"æŒºæ‹”"ã€"å¾®å¾®å‰å€¾"ï¼‰
  };
  uniqueMarks?: string[]; // è®°å¿†ç‚¹ï¼šç–¤ç—• / èƒè®° / ç‰¹æ®Šæ ‡å¿—
}
```

### 3.4 CostumeConfigï¼ˆæœè£…ç»“æ„åŒ–é…ç½®ï¼‰

> Stage4 å¯¹åº”ç°æœ‰ 6 ç»´åº¦æœè£…è§„åˆ™ï¼Œæ‹†æˆç»“æ„åŒ–å­—æ®µï¼›ä¾› PromptCompiler ç²¾ç¡®æ‹¼è£…

```ts
// å•å±‚æœè£…æè¿°ï¼ˆ6 ç»´åº¦ï¼‰
interface CostumeLayer {
  material: string;     // æè´¨ï¼ˆä¸ç»’ã€ç²—å¸ƒéº»ï¼‰
  cut: string;          // ç‰ˆå‹å‰ªè£ï¼ˆå®½æ¾ã€æ”¶è…°ã€ç›´ç­’ï¼‰
  color: string;        // é¢œè‰²
  pattern?: string;     // èŠ±çº¹ï¼ˆç¢èŠ±ã€æš—çº¹ã€ç´ è‰²ï¼‰
  details?: string;     // å·¥è‰ºç»†èŠ‚ï¼ˆåˆºç»£ã€ç›˜æ‰£ã€æµè‹ï¼‰
  wornState?: string;   // æ–°æ—§ç¨‹åº¦ï¼ˆå…¨æ–°ã€ç•¥æ—§ã€ç ´æŸï¼‰
}

interface CostumeConfig {
  inner?: CostumeLayer;   // å†…å±‚ï¼ˆè´´èº«ï¼‰
  middle: CostumeLayer;   // ä¸­å±‚ï¼ˆä¸»ä½“ä¸Šè£…ï¼Œå¿…æœ‰ï¼‰
  outer?: CostumeLayer;   // å¤–å±‚ï¼ˆå¤–å¥—/æŠ«é£ï¼Œå¯é€‰ï¼‰
  bottom: CostumeLayer;   // ä¸‹è£…ï¼ˆè£™/è£¤/è¿è¡£è£™ï¼Œå¿…æœ‰ï¼‰
  shoes: CostumeLayer;    // é‹é´
  accessories?: {
    jewelry?: string;     // é¦–é¥°
    belt?: string;        // è…°å¸¦/è…°å°
    bag?: string;         // åŒ…/é…åŒ…
    props?: string;       // éšèº«é“å…·ï¼ˆæ‰‡å­/å‰‘/ä¹¦æœ¬ï¼‰
  };
}
```

### 3.5 HumanDescriptionï¼ˆå‰ç«¯è§’è‰²å¡æ–‡æ¡ˆï¼‰

> ç”± HumanDescriptionGenerator ä»ç»“æ„åŒ–é…ç½®ç”Ÿæˆï¼›ç»™äººè¯»ï¼Œä¸ç»™æ¨¡å‹ç”¨

```ts
interface HumanDescription {
  mainAppearance: string;  // ã€ä¸»ä½“äººç‰©ã€‘äººç§/æ—¶ä»£/å¹´é¾„/ä½“æ€/æ•´ä½“æ°”è´¨
  facialFeatures: string;  // ã€å¤–è²Œç‰¹å¾ã€‘äº”å®˜+è‚¤è´¨+å‘å‹+è®°å¿†ç‚¹ï¼ˆ100-150å­—ï¼‰
  costume: string;         // ã€æœé¥°é€ å‹ã€‘å†…/ä¸­/å¤–å±‚+ä¸‹è£…+é‹+é…é¥°ï¼ˆåˆ†å±‚ç»“æ„ï¼Œ180-260å­—ï¼‰
  extraNotes?: string;     // å‰§æœ¬åŸæ–‡æ‘˜å½•ï¼ˆè‹¥æœ‰ï¼‰
}
```

### 3.6 GenerationPromptï¼ˆç”Ÿå›¾ Promptï¼‰

> ç”± PromptCompiler ä»ç»“æ„åŒ–é…ç½®ç¼–è¯‘ï¼›ç»™ nano banana proï¼Œä¸å†™è¿›è§’è‰²å¡

```ts
interface GenerationPrompt {
  positive: string;         // æ­£å‘ Promptï¼ˆè‹±æ–‡å…³é”®è¯+çŸ­è¯­ï¼‰
  negative?: string;        // è´Ÿå‘ Promptï¼ˆé¿å…å¤±æ§çš„çº¦æŸè¯ï¼‰
  params: {
    aspectRatio?: string;   // ç”»å¹…æ¯”ä¾‹ï¼ˆ2:3 / 16:9 / 1:1ï¼‰
    steps?: number;
    stylePreset?: string;   // æœ€ç»ˆç”Ÿæ•ˆé£æ ¼ï¼ˆeffectiveStylePresetï¼‰
    seed?: number;          // å³ identitySeedï¼Œè·¨å½¢æ€å¤ç”¨
  };
  meta?: {
    version: string;             // ç¼–è¯‘å™¨ç‰ˆæœ¬
    compiledFrom: string[];      // æº¯æºå­—æ®µè·¯å¾„ï¼ˆå¦‚ ["appearanceConfig.hair", "costumeConfig.bottom"]ï¼‰
    generatedAt: string;         // ISO æ—¶é—´æˆ³
  };
}
```

### 3.7 RoleAssetï¼ˆåŸºç¡€å½¢æ€é¡¶å±‚å®¹å™¨ï¼‰

```ts
interface RoleAsset {
  id: string;
  semanticSkeleton: SemanticSkeleton;
  visualConfig: VisualConfig;
  appearanceConfig: AppearanceConfig;
  costumeConfig: CostumeConfig;
  humanDescription: HumanDescription;
  generationPrompt: GenerationPrompt;
  assetVersion: string;       // ç‰ˆæœ¬å·ï¼ˆå¦‚ "v1"ï¼‰
  generatedBy?: string;       // ä½¿ç”¨çš„ LLM æ¨¡å‹
  createdAt: string;          // ISO æ—¶é—´æˆ³
  updatedAt?: string;
}
```

---

## å››ã€å¤šå½¢æ€è®¾è®¡ï¼ˆBaseline + Deltaï¼‰

### 4.1 å½¢æ€åˆ†ç±»

ç³»ç»Ÿæ”¯æŒä¸¤ä¸ªç»´åº¦çš„å¤šå½¢æ€ï¼š

| changeType | ç±»å‹ | å½±å“å±‚ | å…¸å‹ç¤ºä¾‹ |
|------------|------|--------|---------|
| `costume` | é€ å‹å½¢æ€ | åªæ”¹ CostumeConfig | ä¾¿è£… â†’ æˆ˜æ–—è£… â†’ ç¤¼æœ |
| `makeup` | å¦†å®¹å½¢æ€ | åªæ”¹ AppearanceConfig å±€éƒ¨ | æ—¥å¸¸å¦† â†’ æµ“å¦† â†’ æ— å¦† |
| `damage` | æˆ˜æŸå½¢æ€ | AppearanceConfig(uniqueMarks) + CostumeConfig | å®Œæ•´ â†’ è¡€è¡£ç ´æŸ â†’ é‡ä¼¤ |
| `transformation` | å˜èº«å½¢æ€ | å¯è¦†ç›– AppearanceConfig + VisualConfig | äººå½¢ â†’ å…½å½¢ â†’ é»‘åŒ– |

### 4.2 å½¢æ€èµ„äº§ï¼ˆFormAssetï¼‰

> æ¯ä¸ªéåŸºç¡€å½¢æ€åªè®°å½•"ä¸ baseline çš„å·®å¼‚ï¼ˆdeltaï¼‰"ï¼Œä¸é‡å¤å­˜å‚¨å…¨é‡æ•°æ®

```ts
interface FormDelta {
  appearanceConfig?: Partial<AppearanceConfig>;  // åªå†™å˜åŒ–çš„å­—æ®µ
  costumeConfig?: Partial<CostumeConfig>;
  visualConfig?: Partial<VisualConfig>;          // ä»… transformation ç±»å‹éœ€è¦
}

interface FormAsset {
  id: string;
  name: string;                    // "æˆ˜æŸå½¢æ€" | "é»‘åŒ–è§‰é†’" | "ç¤¼æœé€ å‹"
  changeType: CharacterForm['changeType'];
  episodeRange?: string;           // å‡ºç°é›†æ•°ï¼ˆå¦‚ "Ep 32-36"ï¼‰
  delta: FormDelta;                // ä¸ baseline çš„å·®å¼‚ï¼ˆPromptCompiler åˆå¹¶æ—¶ä½¿ç”¨ï¼‰
  description: string;            // å®Œæ•´çš„äººç±»å¯è¯»æè¿°ï¼ˆå«ã€ä¸»ä½“äººç‰©ã€‘ã€å¤–è²Œç‰¹å¾ã€‘ã€æœé¥°é€ å‹ã€‘ï¼‰
  isKeyframe: boolean;            // æ˜¯å¦ä¼˜å…ˆç”Ÿæˆè®¾å®šå›¾
  priority: number;               // æ’åºä¼˜å…ˆçº§ï¼ˆ100 æœ€é«˜ï¼‰
  imageSheetUrl?: string;         // å·²ç”Ÿæˆçš„å½¢æ€è®¾å®šå›¾ OSS URL
  imageGenerationMeta?: CharacterRef['imageGenerationMeta'];
}
```

### 4.3 è§’è‰²èµ„äº§é›†åˆï¼ˆRoleAssetCollectionï¼‰

```ts
interface RoleAssetCollection {
  characterId: string;
  baseline: RoleAsset;         // åŸºç¡€å½¢æ€ï¼ˆå®Œæ•´æ•°æ®ï¼‰
  forms: FormAsset[];          // å…¶ä»–å½¢æ€ï¼ˆä»… deltaï¼‰
  identitySeed: number;        // èº«ä»½ä¸€è‡´æ€§ seedï¼ˆæ‰€æœ‰å½¢æ€å¤ç”¨ï¼Œä¿è¯è„¸å‹ç»Ÿä¸€ï¼‰
}
```

### 4.4 å¤šå½¢æ€ Prompt ç”Ÿæˆè§„åˆ™

```
åŸºç¡€å½¢æ€ Promptï¼š
  PromptCompiler(baseline.appearanceConfig, baseline.costumeConfig, uiStylePreset, identitySeed)

å…¶ä»–å½¢æ€ Promptï¼ˆä»¥ "æˆ˜æŸå½¢æ€" ä¸ºä¾‹ï¼‰ï¼š
  effectiveAppearance = merge(baseline.appearanceConfig, form.delta.appearanceConfig)
  effectiveCostume    = merge(baseline.costumeConfig,    form.delta.costumeConfig)
  PromptCompiler(effectiveAppearance, effectiveCostume, uiStylePreset, identitySeed)

merge è§„åˆ™ï¼š
  - delta ä¸­æŒ‡å®šçš„å­—æ®µè¦†ç›– baseline å¯¹åº”å­—æ®µ
  - delta ä¸­æœªæŒ‡å®šçš„å­—æ®µå…¨éƒ¨ç»§æ‰¿ baseline
  - identitySeed æ°¸è¿œä¸å˜ï¼ˆä¿è¯äººè„¸ä¸€è‡´ï¼‰
```

### 4.5 ä¸‰é˜¶æ®µæ¸è¿›å¼å½¢æ€ç”Ÿæˆï¼ˆä¸è®¾æ•°é‡ä¸Šé™ï¼‰

> æ ¸å¿ƒç†å¿µï¼š**è¯†åˆ«æ‰€æœ‰å½¢æ€ï¼ˆå…è´¹ï¼‰ï¼›ç”Ÿæˆå½¢æ€ï¼ˆä»˜è´¹ï¼‰ç”±ç”¨æˆ·ä¸»å¯¼**ã€‚
> ä¸€éƒ¨å‰§ä¸»è§’å¯èƒ½æœ‰ 40+ æ¬¡æ¢è£…/å˜èº«ï¼Œä¸åº”å¼ºåˆ¶é™åˆ¶æ•°é‡ï¼Œè€Œæ˜¯è®©ç”¨æˆ·å†³å®šç”Ÿæˆå“ªäº›ã€‚

#### Phase 1ï¼šè‡ªåŠ¨ãƒ»è½»é‡ï¼ˆé€‰æ‹©è§’è‰²åè‡ªåŠ¨è§¦å‘ï¼‰

å¹¶è¡Œæ‰§è¡Œä¸¤ä»¶äº‹ï¼š
- **Stage1â€“5 æ€ç»´é“¾** â†’ ç”Ÿæˆå¸¸æ€å®Œæ•´ `RoleAsset`ï¼ˆbaselineï¼‰
- **Stage5.5 è½»é‡æ‰«æ** â†’ ä»å…¨é‡å‰§æœ¬æå– `FormSummary[]`ï¼ˆå½¢æ€æ¸…å•ï¼Œåªæœ‰å…ƒæ•°æ®ï¼Œä¸ç”Ÿæˆæè¿°ï¼‰

`FormSummary` ç»“æ„ï¼ˆè½»é‡ï¼‰ï¼š

```ts
interface FormSummary {
  id: string;
  name: string;           // "æˆ˜ç”²å½¢æ€" | "é»‘åŒ–è§‰é†’" | "ä¾¿è£…é€ å‹"
  changeType: 'costume' | 'makeup' | 'damage' | 'transformation';
  episodeRange?: string;  // "Ep.12-15"
  triggerEvent: string;   // "é¦–æ¬¡å‡ºå¾å‰æ¢ä¸Šæˆ˜ç”²"
  sourceQuote: string;    // å‰§æœ¬åŸæ–‡ä¾æ®ï¼ˆ50å­—å†…ï¼‰
  status: 'pending';      // åˆå§‹çŠ¶æ€ï¼Œå¾…ç”¨æˆ·è§¦å‘ç”Ÿæˆ
}
```

#### Phase 2ï¼šç”¨æˆ·ä¸»å¯¼ãƒ»å½¢æ€å®¡æŸ¥

ç”¨æˆ·åœ¨ UI çœ‹åˆ°å½¢æ€æ¸…å•ï¼ˆå¡ç‰‡å½¢å¼ï¼‰ï¼Œå¯ä»¥ï¼š

- âœ… å•ä¸ªç‚¹å‡»"ç”Ÿæˆè¯¦ç»†æè¿°" â†’ è§¦å‘ Phase 3
- âœ… å¤šé€‰æ‰¹é‡ç”Ÿæˆ
- âœ… ç¼–è¾‘å…ƒæ•°æ®ï¼ˆåç§°/ç±»å‹/é›†æ•°ï¼‰åå†ç”Ÿæˆ
- âœ… åˆ é™¤ä¸é‡è¦çš„å½¢æ€
- âœ… æ‰‹åŠ¨æ–°å¢å‰§æœ¬æœªæ˜ç¡®å†™å‡ºçš„å½¢æ€

#### Phase 3ï¼šæŒ‰éœ€è¯¦ç»†ç”Ÿæˆï¼ˆç”¨æˆ·è§¦å‘ï¼Œæ¯ä¸ªå½¢æ€ç‹¬ç«‹ï¼‰

å¯¹é€‰å®šå½¢æ€è¿è¡Œå®Œæ•´ç”Ÿæˆé“¾ï¼š
1. ä»å‰§æœ¬æŠ½å–è¯¥å½¢æ€çš„åŸæ–‡ä¾æ®ï¼ˆsourceQuote å‘¨è¾¹ä¸Šä¸‹æ–‡ï¼‰
2. åŸºäº baseline delta ç”Ÿæˆ `FormDelta`ï¼ˆåªå†™å·®å¼‚å­—æ®µï¼‰
3. ç”Ÿæˆ `FormAsset.description`ï¼ˆå®Œæ•´äººç±»å¯è¯»æè¿°ï¼‰
4. è°ƒç”¨ PromptCompiler ç”Ÿæˆè¯¥å½¢æ€çš„ `GenerationPrompt`
5. å°† `FormSummary` å‡çº§ä¸ºå®Œæ•´ `FormAsset`ï¼Œstatus æ›´æ–°ä¸º `'generated'`

---

## äº”ã€Stage1â€“5 ä¸ RoleAsset å­—æ®µæ˜ å°„

| Stage | å¡«å……å­—æ®µ | å…³é”®è¾“å…¥ |
|-------|---------|---------|
| Stage1 | `semanticSkeleton.basic / position / personality / scriptType / scenes / scriptAppearance` | character + scriptsï¼ˆå‰ 6000 å­—ï¼‰ |
| Stage2 | `visualConfig` | semanticSkeleton + å¤–è²Œåº“è½»é‡å‚è€ƒ |
| Stage3 | `appearanceConfig` + `humanDescription.mainAppearance / facialFeatures` | semanticSkeleton + visualConfig.appearanceIntent + appearanceReference |
| Stage4 | `costumeConfig` + `humanDescription.costume` | semanticSkeleton + visualConfig.costumeIntent + appearanceConfig + costumeReference + materialVocabulary |
| Stage5 | `semanticSkeleton.facts` | semanticSkeleton + scriptsï¼ˆå‰ 8000 å­—ï¼‰ |
| Stage5.5 | `RoleAssetCollection.forms[]` | semanticSkeleton + scriptsï¼ˆå…¨é‡ï¼‰ |

**Stage3/4 ä¿¡å·ä¼˜å…ˆçº§ï¼ˆç”±é«˜åˆ°ä½ï¼‰ï¼š**

```
å‰§æœ¬åŸæ–‡ï¼ˆscriptAppearanceï¼‰
  > ç´ æåº“ï¼ˆappearanceReference / costumeReferenceï¼‰
    > VisualConfig æ„å›¾ï¼ˆappearanceIntent / costumeIntentï¼‰
      > LLM è‡ªç”±å‘æŒ¥
```

---

## å…­ã€PromptCompiler è®¾è®¡

### 6.1 æ¥å£å®šä¹‰

```ts
interface PromptCompilerInput {
  appearanceConfig: AppearanceConfig;
  costumeConfig: CostumeConfig;
  semanticSkeleton: Pick<SemanticSkeleton, 'basic' | 'scriptType'>;
  visualConfig: Pick<VisualConfig, 'aesthetic' | 'anchors'>;
  uiStylePreset?: string;      // ğŸ”‘ UI é¡µé¢ç”¨æˆ·é€‰æ‹©çš„æ¸²æŸ“é£æ ¼ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
  identitySeed?: number;       // å¤ç”¨ baseline çš„ seed
  projectId?: string;          // ç”¨äºåŠ è½½é¡¹ç›®çº§ styling-guide
}

interface PromptCompilerOutput {
  positive: string;
  negative: string;
  params: GenerationPrompt['params'];
  meta: GenerationPrompt['meta'];
}
```

### 6.2 ç¼–è¯‘æ­¥éª¤

**Step 1ï¼šç¡®å®š effectiveStylePresetï¼ˆæ¸²æŸ“é£æ ¼ï¼‰**

```
ä¼˜å…ˆçº§ï¼š
  â‘  uiStylePresetï¼ˆç”¨æˆ·åœ¨ UI é¡µé¢é€‰æ‹©ï¼‰â†’ æœ€é«˜ä¼˜å…ˆçº§
  â‘¡ projectId å¯¹åº”çš„ styling-guide.json é»˜è®¤é£æ ¼
  â‘¢ visualConfig.aesthetic.styleTagï¼ˆç³»ç»Ÿæ¨æ–­ï¼‰â†’ å…œåº•

å†²çªå¤„ç†ï¼š
  - ç”¨æˆ·é£æ ¼ä¸å‰§æœ¬ç±»å‹æ˜æ˜¾å†²çªæ—¶ï¼ˆå¦‚"çºªå®ç°å®ä¸»ä¹‰" + "äºŒæ¬¡å…ƒQç‰ˆ"ï¼‰
  - ç³»ç»Ÿä¸å¼ºè¡Œé˜»æ­¢ï¼Œè®°å½• warning æ—¥å¿—ï¼Œåç»­åœ¨ UI å±‚ç»™å‡ºæç¤º
```

**Step 2ï¼šä» AppearanceConfig æç‚¼å¤–è²Œ Prompt ç‰‡æ®µ**

```
faceShape â†’ "oval face" / "square jawline"
eyes      â†’ "almond-shaped eyes, sharp gaze"
skin      â†’ "porcelain skin, subtle glow"
hair      â†’ "long wavy hair loosely tied, lustrous texture"
body      â†’ "7.5 heads tall, slender, upright posture"
uniqueMarks â†’ "scar above left eyebrow"
```

**Step 3ï¼šä» CostumeConfig æç‚¼æœè£… Prompt ç‰‡æ®µ**

```
middle  â†’ æè´¨ + å‰ªè£ + é¢œè‰² + ç»†èŠ‚
bottom  â†’ åŒä¸Š
shoes   â†’ æè´¨ + æ¬¾å¼ + é¢œè‰²
accessories â†’ é€é¡¹è½¬æ¢ä¸ºè‹±æ–‡çŸ­è¯­
```

**Step 4ï¼šé™„åŠ å…¨å±€é£æ ¼æŠ€æ³•è¯ï¼ˆåªè¿› Promptï¼Œä¸å†™è§’è‰²å¡ï¼‰**

```
effectiveStylePreset = "çœŸå®ç”µå½±æ„Ÿ" â†’
  é™„åŠ ï¼šcinematic lighting, 35mm lens, shallow depth of field, realistic skin texture

effectiveStylePreset = "å¤é£å”¯ç¾" â†’
  é™„åŠ ï¼špainterly style, soft glow, traditional Chinese aesthetics, volumetric lighting

effectiveStylePreset = "äºŒæ¬¡å…ƒå†™å®" â†’
  é™„åŠ ï¼šanime illustration, clean linework, cel shading, vibrant color palette
```

**Step 5ï¼šåˆæˆ positive / negativeï¼Œè®°å½• meta**

```
positive = [å¤–è²Œç‰‡æ®µ] + [æœè£…ç‰‡æ®µ] + [å…¨å±€é£æ ¼æŠ€æ³•]
negative = é¡¹ç›®é»˜è®¤å®‰å…¨æ¨¡æ¿ + anchors.mustAvoid

meta.compiledFrom = è®°å½•ç”¨åˆ°çš„å­—æ®µè·¯å¾„ï¼ˆä¾¿äºè°ƒè¯•ï¼‰
params.seed = identitySeedï¼ˆè·¨å½¢æ€ç»Ÿä¸€ï¼‰
```

---

## ä¸ƒã€HumanDescription ç”Ÿæˆå™¨

> ä»ç»“æ„åŒ–é…ç½®ç”Ÿæˆäººç±»å¯è¯»æ–‡æ¡ˆï¼›**ç‹¬ç«‹äº PromptCompiler**ï¼Œäº’ä¸å½±å“

```ts
interface HumanDescriptionGenerator {
  generate(input: {
    semanticSkeleton: SemanticSkeleton;
    appearanceConfig: AppearanceConfig;
    costumeConfig: CostumeConfig;
  }): HumanDescription;
}
```

**ç”Ÿæˆè§„åˆ™ï¼š**

- `mainAppearance`ï¼šäººç§ + æ—¶ä»£ + å¹´é¾„æ®µ + ä½“æ€ + æ•´ä½“æ°”è´¨ï¼ˆ50-80å­—ï¼‰
- `facialFeatures`ï¼šäº”å®˜ + è‚¤è´¨ + å‘å‹ + è®°å¿†ç‚¹ï¼Œä½¿ç”¨å½±è§†ç¾å­¦è¯æ±‡ï¼ˆ100-150å­—ï¼‰
  - âœ… ä½¿ç”¨ï¼š"å¯Œæœ‰å…‰æ³½"ã€"æ¸…æ¾ˆæ˜äº®"ã€"æ¸©æ¶¦å¦‚ç‰"
  - âŒ ç¦æ­¢ï¼š"ç•¥æ˜¾ç–²æƒ«"ã€"å‘è´¨ç²—ç³™"ã€"è‚¤è‰²æš—æ²‰"
- `costume`ï¼šåˆ†å±‚ç»“æ„ï¼ˆå†…/ä¸­/å¤– + ä¸‹è£… + é‹é´ + æŒ‚ä»¶ï¼‰ï¼Œ180-260å­—
  - ç¦æ­¢å‡ºç°ç”Ÿå›¾æŠ€æ³•è¯ï¼ˆå¦‚ "rim light"ã€"35mm lens"ï¼‰

---

## å…«ã€ä¼˜å…ˆçº§è§„åˆ™æ€»è¡¨

| åœºæ™¯ | è§„åˆ™ | ä¼˜å…ˆçº§ |
|------|------|--------|
| æ¸²æŸ“é£æ ¼ | UIé€‰æ‹© > é¡¹ç›®é»˜è®¤ > è„šæœ¬ç±»å‹æ¨æ–­ | æœ€é«˜ |
| å¤–è²Œ/æœè£…ç»†èŠ‚ | å‰§æœ¬åŸæ–‡ > ç´ æåº“ > VisualConfigæ„å›¾ > LLMæ¨æ–­ | é«˜ |
| å¤šå½¢æ€Prompt | baseline delta mergeï¼ŒidentitySeed æ°¸ä¸å˜ | é«˜ |
| å½¢æ€ç”Ÿæˆ | Phase1è‡ªåŠ¨æå–æ¸…å•ï¼ˆä¸é™æ•°é‡ï¼‰ï¼›Phase3æŒ‰éœ€ç”Ÿæˆï¼Œç”±ç”¨æˆ·å†³å®šä¼˜å…ˆçº§ | ä¸­ |
| å¤–è²Œ/æœè£…ä¿¡å· | AppearanceConfig â†’ Stage3ä¸“å±ï¼›CostumeConfig â†’ Stage4ä¸“å± | å¼ºéš”ç¦» |

---

## ä¹ã€æ‰©å±•ç‚¹ï¼ˆæœªæ¥æ¼”è¿›ï¼‰

| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| æ°”è´¨/ç¾å‹æ¨¡æ¿åº“ | `temperament-reference.json`ï¼š10-15ç§æ°”è´¨æ¨¡æ¿ â†’ ç»†åŒ– VisualConfig.temperament | é«˜ |
| é¡¹ç›®çº§é£æ ¼åº“ | æ‰©å±• `styling-guide.json`ï¼šå®šä¹‰é£æ ¼é¢„è®¾ + é»˜è®¤ negative prompt | é«˜ |
| Stage2 VisualConfig é‡æ„ | ç°æœ‰ `visualTags[]` å‡çº§ä¸º `VisualConfig` ç»“æ„ | ä¸­ |
| Stage1 motivation å­—æ®µ | è¡¥å…… `wants / fears`ï¼Œé©±åŠ¨æ›´æœ‰å™äº‹æ€§çš„è§†è§‰è®¾è®¡ | ä¸­ |
| è§’è‰²åŒºåˆ†åº¦æ£€æµ‹ | åŸºäº AppearanceConfig è®¡ç®—è·¨è§’è‰²ç›¸ä¼¼åº¦ï¼Œç»™å‡ºç›¸ä¼¼åº¦è­¦å‘Š | ä½ |
| è§’è‰²èµ„äº§è·¨é¡¹ç›®å¤ç”¨ | RoleAssetCollection åºåˆ—åŒ–åå¯åœ¨ä¸åŒé¡¹ç›®å¯¼å…¥ | ä½ |

---

*æ–‡æ¡£ç»´æŠ¤ï¼šä¸ä»£ç é‡æ„åŒæ­¥æ›´æ–°ã€‚æ¯æ¬¡ä¿®æ”¹ Stage1â€“5 çš„è¾“å‡ºç»“æ„æ—¶ï¼Œéœ€åŒæ­¥æ ¸æŸ¥æœ¬æ–‡æ¡£çš„å­—æ®µæ˜ å°„è¡¨ã€‚*



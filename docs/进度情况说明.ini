
> æœ€åæ›´æ–°ï¼š2026-02-27ï¼ˆBug A/B/C ä¿®å¤å®Œæˆï¼šStage3éªŒè¯æ”¾å®½ + Stage4 Step4.2å»JSONåŒ– + App.tsx projectRefåŒæ­¥ï¼‰

## ğŸ“Š æ–‡æ¡£ vs å®ç°æƒ…å†µå…¨é¢æ¯”å¯¹

### âœ… å·²å®ç°

| æ¨¡å— | è¯´æ˜ | å®Œæˆæ—¶é—´ |
|------|------|---------|
| Phase 1 FormSummary è½»é‡æ‰«æ | Stage5.5 â†’ `extractFormSummaries()` â†’ `character.formSummaries[]` | æ—©æœŸ |
| Phase 2 å®¡æŸ¥ UI | å½¢æ€æ¸…å•å¡ç‰‡ï¼Œæ”¯æŒåˆ é™¤ã€æŸ¥çœ‹å…ƒæ•°æ® | æ—©æœŸ |
| Phase 3 æŒ‰éœ€å±•å¼€è®¾è®¡ | `generateFormDetail.ts` + å…¨å±€é”å¤ç”¨ | æ—©æœŸ |
| `identitySeed` å­—æ®µ | å·²åœ¨ `CharacterRef` å®šä¹‰ï¼ˆL99ï¼‰ï¼Œç”¨äºè·¨å½¢æ€è„¸å‹ä¸€è‡´ | æ—©æœŸ |
| `FormSummary` ç»“æ„ | å®Œæ•´å®ç°ï¼Œå« status çŠ¶æ€æœº | æ—©æœŸ |
| å¤–è²Œåº“ / æœè£…åº“ / æè´¨è¯æ±‡åº“ | `appearance-reference.json` / `costume-reference.json` / `materialVocabulary.json` | æ—©æœŸ |
| `styling-guide.json` | å·²æœ‰æ–‡ä»¶ | æ—©æœŸ |
| **æ—¶é—´çº¿é¢„æ ‡æ³¨ï¼ˆTimeline Pre-labelingï¼‰** | Stage5.5 é€šè¯»å‰§æœ¬è¯†åˆ«äººç”Ÿé˜¶æ®µï¼ˆå‰ä¸–/é‡ç”Ÿåï¼‰ï¼Œé€ä¼ è‡³åç»­ç¯èŠ‚ | 2026-02 |
| **Phase 2 å¤šé€‰æ‰¹é‡ç”Ÿæˆ** | `ProjectDashboard.tsx` å·²å®ç°å¤šé€‰ + æ‰¹é‡è§¦å‘å±•å¼€è®¾è®¡ | 2026-02 |
| **Phase 2 ç¼–è¾‘å…ƒæ•°æ®åå†ç”Ÿæˆ** | æ”¯æŒç¼–è¾‘å½¢æ€åç§°/ç±»å‹/é›†æ•°åè§¦å‘é‡æ–°ç”Ÿæˆ | 2026-02 |
| **Phase 2 æ‰‹åŠ¨æ–°å¢å½¢æ€** | æ”¯æŒæ‰‹åŠ¨æ–°å¢å‰§æœ¬æœªæ˜ç¡®å†™å‡ºçš„å½¢æ€ | 2026-02 |
| **Task Bï¼šAppearanceConfig** | `types.ts` æ–°å¢æ¥å£ï¼›Stage3 è¾“å‡ºç»“æ„åŒ–å¤–è²Œé…ç½®ï¼ˆfaceShape/eyes/brows/nose/lips/skin/hair/bodyï¼‰ | 2026-02 |
| **Task Bï¼šCostumeConfig** | `types.ts` æ–°å¢æ¥å£ï¼›Stage4 è¾“å‡ºåˆ†å±‚ç»“æ„åŒ–æœè£…é…ç½®ï¼ˆinner/middle/outer/bottom/shoes/accessoriesï¼‰ | 2026-02 |
| **Task Bï¼šCharacterRef æ‰©å±•** | `storyboard/types.ts` æ–°å¢ `appearanceConfig?` å’Œ `costumeConfig?` å­—æ®µï¼ˆæŒä¹…åŒ–ï¼‰ | 2026-02 |
| **Task Cï¼šPromptCompiler** | `promptCompiler.ts`ï¼ˆæ–°å»ºï¼Œ~320è¡Œï¼‰ï¼›11å¼ ä¸­è‹±æ–‡æ˜ å°„è¡¨ï¼›`mergeConfig` Baseline+Delta åˆå¹¶ï¼›`compilePrompt` ç¡®å®šæ€§ç¼–è¯‘ | 2026-02 |
| **Task Cï¼šgenerateFormDetail é›†æˆ** | æœ‰ç»“æ„åŒ–é…ç½®æ—¶è‡ªåŠ¨è°ƒç”¨ç¼–è¯‘å™¨ï¼Œæ— åˆ™é™çº§è‡³ LLMï¼ˆå‘åå…¼å®¹ï¼‰ | 2026-02 |
| **Task Dï¼šæ°”è´¨/ç¾å‹æ¨¡æ¿åº“ï¼ˆæ•°æ®å±‚ï¼‰** | `temperament-reference.json`ï¼ˆ8ç§æ¨¡æ¿ï¼‰+ `temperament-reference.types.ts`ï¼ˆç±»å‹å®šä¹‰ï¼‰ | 2026-02-27 |
| **Task Dï¼šæ°”è´¨æ¨¡æ¿åº“æ¥å…¥ Stage2** | `getTemperamentReference.ts` è½¯åŒ¹é…ç®—æ³•ï¼›`stage2-visual-tags-optimized/fast.ts` æ³¨å…¥è‰²å½©/çœ¼ç¥/æœè£…å¼•å¯¼ | 2026-02-27 |
| **Task Dï¼šæ°”è´¨æ¨¡æ¿åº“æ¥å…¥ Stage3** | `stage3-appearance-design-optimized/fast.ts` æ³¨å…¥å¤–è²Œæ°”è´¨å¼•å¯¼ï¼ˆæé—®å¼ï¼Œéç¡¬ç¼–ç ï¼‰ | 2026-02-27 |
| **Bug A ä¿®å¤ï¼ˆStage3éªŒè¯æ”¾å®½ï¼‰** | `index.ts` `executeStage3` optimizedæ¨¡å¼éªŒè¯ä»6å­—æ®µâ†’ä»…æ ¡éªŒ`finalDescription.mainCharacter/facialFeatures`ï¼Œæ¶ˆé™¤step3_*/è¯­ä¹‰å­—æ®µä¸å¯¹é½å¤±è´¥ | 2026-02-27 |
| **Bug B ä¿®å¤ï¼ˆStage4 Step4.2å»JSONåŒ–ï¼‰** | `stage4-costume-design-optimized.ts` Step 4.2è¾“å‡ºä»JSONä»£ç å—æ”¹ä¸ºæ–‡æœ¬è¦ç‚¹ï¼Œé˜²æ­¢LLMåœ¨ä¸­é—´æ­¥éª¤çŸ­è·¯æå‰åœæ­¢ | 2026-02-27 |
| **Bug C ä¿®å¤ï¼ˆApp.tsx projectRefåŒæ­¥ï¼‰** | `App.tsx` `onStageComplete` å†™åº“æˆåŠŸåå¢åŠ  `projectRef.current.characters = updatedCharacters`ï¼Œé˜²æ­¢å…œåº•upsertç”¨æ—§æ•°æ®è¦†ç›–å·²ç”Ÿæˆç»“æœ | 2026-02-27 |
| Bug D ä¿®å¤ï¼ˆStage5.5 å½¢æ€æ‰«æå…œåº•è§¦å‘ï¼‰ | `characterCompleteness.ts` åœ¨æ­£åˆ™æå–ä¸åˆ°å½¢æ€ä¸”æœªåšè¿‡ LLM æ‰«ææ—¶ï¼Œä¹Ÿå°† forms è®°ä¸ºç¼ºå¤±ï¼Œç¡®ä¿ Stage5.5 è‡³å°‘æ‰§è¡Œä¸€æ¬¡ | 2026-02-28 |
| Bug E ä¿®å¤ï¼ˆStage5 abilities æ–‡æ¡ˆç®€åŒ–ï¼‰ | `stage5-character-facts.ts` å°† abilities æ”¹ä¸ºç®€æ´èƒ½åŠ›/æ€§æ ¼æ ‡ç­¾ï¼Œä¸å†å¼ºåˆ¶é™„å¸¦é›†æ•°+åŸæ–‡ç‰‡æ®µ | 2026-02-28 |

---

### âŒ æœªå®ç°ï¼ˆé‡è¦æ¨¡å—ï¼‰

#### ä¸€ã€æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ˆç¬¬ä¸‰ç« ï¼‰â€” éƒ¨åˆ†ç¼ºå¤±

| æ¥å£ | æ–‡æ¡£å®šä¹‰ | å®é™…ä»£ç  | çŠ¶æ€ |
|------|---------|---------|------|
| `SemanticSkeleton` | ç»Ÿä¸€éª¨æ¶ JSONï¼ˆbasic/position/personality/scriptType/scenesï¼‰ | Stage1 è¾“å‡º `Stage1ScriptAnalysis`ï¼ˆå­—æ®µåä¸ä¸€è‡´ï¼Œä»…å†…éƒ¨ä½¿ç”¨ï¼‰ | âŒ æœªæŒ‰è®¾è®¡å®ç° |
| `VisualConfig` | ç»“æ„åŒ–è§†è§‰ç­–ç•¥ï¼ˆaesthetic/temperament/appearanceIntent/costumeIntentï¼‰ | Stage2 è¾“å‡º `Stage2VisualTags`ï¼ˆvisualTags[] æ•°ç»„ï¼‰ | âŒ è®¾è®¡æ–‡æ¡£ç¬¬ä¹ç« ä¹Ÿæ ‡æ³¨"éœ€é‡æ„" |
| `AppearanceConfig` | ç»“æ„åŒ–å¤–è²Œé…ç½® | âœ… å·²åœ¨ `types.ts` å®šä¹‰å¹¶ç”± Stage3 è¾“å‡º | âœ… |
| `CostumeConfig` | åˆ†å±‚ç»“æ„åŒ–é…ç½® | âœ… å·²åœ¨ `types.ts` å®šä¹‰å¹¶ç”± Stage4 è¾“å‡º | âœ… |
| `RoleAsset` | é¡¶å±‚å®¹å™¨ï¼ˆèšåˆæ‰€æœ‰é…ç½®ï¼‰ | ä¸å­˜åœ¨ | âŒ æœªå®ç° |
| `FormDelta`ï¼ˆç»“æ„åŒ–ï¼‰ | `Partial<AppearanceConfig>` + `Partial<CostumeConfig>` | `CharacterForm.delta` æ˜¯çº¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯ç»“æ„åŒ–å¯¹è±¡ | âŒ éƒ¨åˆ†å®ç° |
| `RoleAssetCollection` | baseline + forms[] + identitySeed é›†åˆå®¹å™¨ | ä¸å­˜åœ¨æ­¤æ•°æ®ç»“æ„ | âŒ æœªå®ç° |

#### äºŒã€ç”Ÿæˆå±‚ï¼ˆç¬¬å…­ã€ä¸ƒç« ï¼‰â€” éƒ¨åˆ†ç¼ºå¤±

| æ¨¡å— | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `PromptCompiler` | 5æ­¥ç¼–è¯‘æµç¨‹ï¼šAppearanceConfig + CostumeConfig â†’ è‹±æ–‡ç”Ÿå›¾ Prompt | âœ… å·²å®ç°ï¼ˆ`promptCompiler.ts`ï¼‰ |
| `HumanDescriptionGenerator` | ä»ç»“æ„åŒ–é…ç½®ç”Ÿæˆè§’è‰²å¡æ–‡æ¡ˆ | âŒ æ— å¯¹åº”æœåŠ¡æ–‡ä»¶ï¼ˆå½“å‰ç”± LLM ç›´æ¥ç”Ÿæˆè‡ªç„¶è¯­è¨€ï¼‰ |

#### ä¸‰ã€ç¬¬ä¹ç« æ‰©å±•ç‚¹

| åŠŸèƒ½ | ä¼˜å…ˆçº§ï¼ˆæ–‡æ¡£ï¼‰ | çŠ¶æ€ |
|------|-------------|------|
| æ°”è´¨/ç¾å‹æ¨¡æ¿åº“ï¼ˆ`temperament-reference.json`ï¼‰ | é«˜ | âœ… å·²å®ç°ï¼ˆ8ç§æ°”è´¨æ¨¡æ¿ï¼‰ |
| Stage2 VisualConfig é‡æ„ | ä¸­ | âŒ æœªåš |
| Stage1 motivation å­—æ®µï¼ˆwants/fearsï¼‰ | ä¸­ | âŒ æœªåš |
| è§’è‰²åŒºåˆ†åº¦æ£€æµ‹ | ä½ | âŒ æœªåš |
| è§’è‰²èµ„äº§è·¨é¡¹ç›®å¤ç”¨ | ä½ | âŒ æœªåš |

---

### æ€»ç»“ï¼ˆ2026-02-27 æ›´æ–°ï¼‰

æ¶æ„ä¸»å¹²å·²å…¨éƒ¨è½åœ°ï¼š

```
Stage3ï¼ˆAppearanceConfigï¼‰
Stage4ï¼ˆCostumeConfigï¼‰
    â†“
promptCompiler.tsï¼ˆç¡®å®šæ€§ç¼–è¯‘ï¼Œé›¶ LLMï¼‰
    â†“
generateFormDetail.tsï¼ˆé›†æˆï¼‰
    â†“
visualPromptEnï¼ˆé«˜è´¨é‡è‹±æ–‡ç”Ÿå›¾ Promptï¼‰
```

**å½“å‰å‰©ä½™ç¼ºå£ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š**

#### ğŸ”´ UI åŠŸèƒ½ï¼ˆä»»åŠ¡åˆ—è¡¨ä¸­å·²è§„åˆ’ï¼ŒIN_PROGRESSï¼‰
- `ProjectDashboard.tsx` æ–°å¢ `handleUpdateFormSummary` / `handleAddFormSummary` å‡½æ•°
- `CharacterCard` Props æ¥å£æ‰©å±•ï¼ˆonUpdateFormSummary / onAddFormSummaryï¼‰
- ç¼–è¾‘å…ƒæ•°æ® UIï¼ˆFormSummary å¡ç‰‡ âœï¸ å†…åµŒç¼–è¾‘è¡¨å•ï¼‰
- æ‰‹åŠ¨æ–°å¢å½¢æ€ UIï¼ˆæ ‡é¢˜è¡Œ ï¼‹ æ–°å¢æŒ‰é’®ï¼‰

#### ğŸŸ¡ è¿‘æœŸè®°å½•è§„åˆ’ä½†æœªæ‰§è¡Œï¼ˆ5ä¸ªä¿®æ”¹ï¼Œä¿®æ”¹7 å·²å®Œæˆï¼‰
- **ä¿®æ”¹1**ï¼š`autoSupplement.ts` å¢åŠ  `onStageComplete` åˆ†æ®µå›è°ƒ
- **ä¿®æ”¹2**ï¼š`ProjectDashboard.tsx` éª¨æ¶å± + åˆ†æ®µ UI æ›´æ–°
- **ä¿®æ”¹4**ï¼š`index.ts` æ™ºèƒ½å½¢æ€è¡¥å…¨ï¼ˆå‰§æƒ…é‡è¦æ€§æ’åºï¼šå‡ºç°æ¬¡æ•°/é›†æ•°/æè¿°é•¿åº¦ï¼‰
- **ä¿®æ”¹5**ï¼š`generateStateAppearance.ts` è¯æ®é©±åŠ¨ Deltaï¼ˆæ¢è£…/æ¢å¦†åˆ¤æ–­ï¼‰
- **ä¿®æ”¹6**ï¼š`ProjectDashboard.tsx` å½¢æ€ç”Ÿå›¾ Nano Banana Pro ä¿®æ”¹æç¤ºè¯æ ¼å¼
- **ä¿®æ”¹7**ï¼š`stage4-costume-design-fast.ts` / `stage4-costume-design-optimized.ts` ç§»é™¤ã€éšèº«é“å…·ã€‘ï¼Œæ”¹ä¸ºã€å¤´é¥°/é¦–é¥°ã€‘ï¼Œå·²å®Œæˆï¼ˆfast+optimized Prompt å·²ç»Ÿä¸€ï¼‰

#### ğŸŸ¢ æˆ˜ç•¥å±‚æ¶æ„ç¼ºå£ï¼ˆä¸­ä½ä¼˜å…ˆçº§ï¼‰
- `HumanDescriptionGenerator`ï¼ˆè§’è‰²å¡æ–‡æ¡ˆç”Ÿæˆï¼‰
- `VisualConfig` ç»“æ„åŒ–é‡æ„ï¼ˆStage2 è¾“å‡ºå‡çº§ï¼‰
- `RoleAsset` / `RoleAssetCollection` é¡¶å±‚å®¹å™¨ï¼ˆå¦‚éœ€è·¨é¡¹ç›®å¤ç”¨ï¼‰

**ä¸‹ä¸€æ­¥ä¼˜å…ˆå»ºè®®ï¼š**

A. **å®Œæˆ UI å››é¡¹**ï¼ˆç¼–è¾‘å…ƒæ•°æ® + æ‰‹åŠ¨æ–°å¢å½¢æ€ï¼Œä»»åŠ¡åˆ—è¡¨ IN_PROGRESS çš„å»¶ç»­ï¼‰
B. **ä¿®æ”¹7**ï¼ˆå·²å®Œæˆï¼šStage4 fast+optimized ç§»é™¤éšèº«é“å…·ï¼‰
C. **ä¿®æ”¹1+2**ï¼ˆéª¨æ¶å±åˆ†æ®µå›è°ƒï¼Œæå‡è¡¥å…¨ä½“éªŒï¼‰
D. **ä¿®æ”¹4+5**ï¼ˆæ™ºèƒ½å½¢æ€è¡¥å…¨ + è¯æ®é©±åŠ¨ Deltaï¼‰

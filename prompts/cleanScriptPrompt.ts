/**
 * 清洗剧本的提示词构建器
 * 用于 cleanScriptStream 函数
 */
export function buildCleanScriptPrompt(script: string): string {
  return `
# 任务：剧本清洗与预处理

你是一位资深电影分镜师，需要对剧本进行"清洗"，分离画面内容和非画面信息。

## 原始剧本
\`\`\`
${script}
\`\`\`

## 清洗规则

### 1. 信息分类
| 类型 | 处理方式 | 举例 |
|-----|---------|------|
| 角色动作 | ✅ 提取为画面内容 | "晋安双手合十" |
| 场景描述 | ✅ 提取为画面内容 | "波纹扩散" |
| 对白 | ✅ 单独提取 | "抓到你了……" |
| 字幕/UI | ✅ 提取为画内元素 | "[警告：核心温度 300%]" |
| **音效** | ⚠️ 提取为情绪标签 | "音效：滋滋声" → 情绪：紧张 |
| **BGM** | ⚠️ 提取为情绪标签 | "BGM：紧张音" → 情绪：恐惧 |
| **时间码** | ❌ 记录后忽略 | "(8–18s)" |
| **镜头建议** | ⚠️ 记录为参考 | "镜头：中景→特写" |

### 2. 提取设定约束
识别剧本中的规则/设定，这些在后续分镜中必须遵守：
- 如"无物理杀伤力" → 禁止画物体破碎/爆炸
- 如"虚拟空间" → 可以有数字化视觉效果

### 3. 评估剧情权重
分析每个场景的重要性，用于指导镜头分配：
- high: 核心事件/高潮/转折 → 建议3-5个镜头
- medium: 重要情节 → 建议2-3个镜头
- low: 铺垫/过渡 → 建议1-2个镜头

## 输出格式

⚠️ 严格要求：直接输出JSON对象，不要任何解释文字！
⚠️ 不要输出 \`\`\`json 代码块，直接输出 { 开头的JSON！
⚠️ 第一个字符必须是 {，最后一个字符必须是 }

{
  "cleanedScenes": [
    {
      "id": "01",
      "originalText": "原始剧本文本...",
      "visualContent": "纯画面内容：晋安双手合十，指尖有电火花",
      "dialogues": ["晋安：抓到你了……"],
      "uiElements": ["[警告：核心温度 300%]"],
      "moodTags": ["紧张", "科技恐惧"]
    }
  ],
  "audioEffects": ["血液接触电路的滋滋声", "虚拟空间扭曲声"],
  "musicCues": ["低沉电子紧张音"],
  "timeCodes": ["(8–18s)"],
  "cameraSuggestions": ["镜头：环绕推进", "镜头：中景→特写"],
  "constraints": [
    {
      "rule": "无物理杀伤力",
      "implication": "波纹不能破坏物体、不能有爆炸",
      "source": "波纹从晋安为圆心扩散，无物理杀伤力"
    }
  ],
  "sceneWeights": [
    {
      "sceneId": "01",
      "weight": "medium",
      "suggestedShots": 2,
      "reason": "开场铺垫，展示主角状态"
    },
    {
      "sceneId": "02",
      "weight": "high",
      "suggestedShots": 4,
      "reason": "核心事件：波纹扩散，规则崩塌"
    }
  ]
}
`;
}

/**
 * 生成分镜脚本的提示词构建器
 * 用于 generateShotListStream 函数
 */
export function buildGenerateShotListPrompt(
  script: string,
  customPrompt: string,
  characterDescriptions: string
): string {
  return `
  Role: AI 漫剧导演 & 提示词专家. You are an expert in Cinematic Storytelling (Framed Ink).

  你是专业的动画分镜师，需要将剧本转换为可执行的分镜脚本。

  ## 用户自定义指令
  ${customPrompt}
  ${characterDescriptions}

  ## 原始剧本
  ${script}

  ================================================================================
  ## 🧹 第一步：剧本预处理（内部思考，不输出）

  在生成分镜之前，先在内心对剧本进行"清洗"：

  ### 1. 分离画面 vs 非画面信息
  | 类型 | 处理方式 | 举例 |
  |-----|---------|------|
  | 角色动作 | ✅ 保留为画面核心 | "晋安双手合十" |
  | 场景描述 | ✅ 保留为画面核心 | "波纹从晋安为圆心扩散" |
  | 对白 | ✅ 保留，标注为对白 | "抓到你了……" |
  | 字幕/UI | ✅ 保留，标注为画内元素 | "[警告：核心温度 300%]" |
  | **音效** | ⚠️ 转为情绪参考，不画面化 | "音效：滋滋声" → 理解为紧张氛围，但不画"电路火花" |
  | **BGM** | ⚠️ 转为情绪参考，不画面化 | "BGM：电子紧张音" → 理解为科幻恐惧氛围 |
  | **时间码** | ❌ 忽略 | "(8–18s)" → 删除，不影响分镜 |
  | **镜头建议** | ⚠️ 仅作参考，不照搬 | "镜头：中景→特写" → 可以参考但根据情境调整 |

  ### 2. 提取剧本设定约束
  识别剧本中的"设定规则"，后续分镜不可违反：
  - 示例：原文"波纹从晋安为圆心扩散，无物理杀伤力"
  - 提取设定：【约束】波纹无物理杀伤力 → 禁止画"物体破碎/爆炸"

  ### 3. 剧情节拍权重分析
  分析每个场景段落的剧情重要性，用于指导镜头分配：
  - 核心事件（高潮/转折）→ 分配更多镜头（3-4个）
  - 过渡/铺垫场景 → 控制镜头数量（1-2个）
  - 单一动作不应拆分超过3个镜头

  ================================================================================
  ## 🎯 短剧漫剧节奏核心要求（必须遵守）

  ### 节奏原则（90秒时长，以秒为单位把控）
  1. **黄金10秒定生死**：开场必须直接切入冲突场景，不做冗余铺垫
     - ❌ 禁止：开场加"开场氛围渲染：天空中的电子眼俯瞰大地"这种与后续动作无直接关联的镜头
     - ✅ 正确：直接从主角的关键动作/冲突开始
  2. **场景快速切换**：多采用10-20秒的短场景，用硬切加快节奏
  3. **单一动作不过度拆分**：
     - 如"晋安双手合十"最多拆成2个镜头（过程+结果）
     - ❌ 禁止拆成5个以上：大远景→中景→特写→面部→瞳孔→...
  4. **不改剧本只丰富画面**：只能补充和丰富原剧本的画面表达，转为生动的动画语言，不要添加原剧本没有的剧情内容

  ### 🚨🚨🚨 镜头数量强制要求（最重要！必须遵守！）

  **🔢 计算公式：剧本段落数 × 3 = 最少镜头数**

  例如：8个剧本段落 × 3 = 最少24个镜头！

  | 剧本段落数 | 最少镜头数 | 推荐镜头数 |
  |-----------|----------|----------|
  | 6段 | 18个 | 22-26个 |
  | 8段 | 24个 | 28-32个 |
  | 10段 | 30个 | 35-40个 |

  ⚠️⚠️⚠️ **硬性规则（违反=任务失败）：**
  - **镜头数 < 剧本段落数×3 = 必须返工！**
  - **绝对禁止：镜头数 ≤ 剧本段落数（如8段只出8个镜头）**
  - **每个剧本段落 = 必须拆分为 3-5 个镜头！**

  ### 📋 剧本段落拆分规则（强制执行！）

  **剧本中的"01｜特写·晋安双手合十"这样的标记是「叙事段落」，不是「镜头」！**
  **每个叙事段落必须拆分为 3-5 个镜头！**

  | 剧本段落类型 | 最少镜头数 | 拆分方式示例 |
  |------------|----------|------------|
  | 角色动作段落 | 3个 | 准备→动作→效果 |
  | 对话段落 | 3个 | 说话者→反应→环境 |
  | 高潮/冲突段落 | 4-5个 | 起因→发展→高潮→反应→后果 |
  | 场景转换段落 | 3个 | 离开→过渡→到达 |

  **拆分示例：**
  剧本段落："01｜特写·晋安双手合十，字幕闪现[警告：核心温度300%]"

  ❌ 错误：只生成1个镜头
  ✅ 正确：拆分为3个镜头
    - 镜头01：晋安面部特写，眼神锐利
    - 镜头02：双手合十的动作特写
    - 镜头03：警告字幕叠加在晋安瞳孔上

  **如何增加镜头（必须执行！）**：
  1. **环境反应镜头**：如"波纹扫过武器架，武器架开始消融"
  2. **角色反应镜头**：如"魔教教主惊恐后退"、"众高手面面相觑"
  3. **UI/界面镜头**：如"系统警告弹窗大特写"、"错误代码快速滚动"
  4. **氛围渲染镜头**：如"天空裂开"、"地面出现裂纹"
  5. **细节特写镜头**：如"晋安手指颤抖"、"汗珠滑落"
  6. **过渡镜头**：如"光芒逐渐扩散"、"阴影笼罩广场"

  ### 开场节奏约束
  - 开场第一个场景最多3-4个镜头，不要超过5个

  ================================================================================
  ## 🎬 第二步：剧本缺口检测与补充（重要！）

  ### 🔍 什么是"剧本缺口"？

  剧本缺口是指相邻段落之间缺失的过渡动作或因果关系。

  **示例（来自当前剧本）**：
  - 段落05："晋安拔剑"
  - 段落06："天道激怒·红雷降下"

  **缺口问题**：
  1. 拔剑之后做了什么？只是站着？挥剑？
  2. 这把剑后续有什么用？段落07-08都没提到剑
  3. 拔剑和天道降雷之间的因果关系是什么？

  ### ✅ 如何补充剧本缺口？

  **规则：在分镜中插入"桥接镜头"，补充缺失的动作或因果**

  | 缺口类型 | 补充方式 | 示例 |
  |---------|---------|------|
  | **动作缺口** | 补充动作后续 | "拔剑后晋安持剑指向天空电子眼" |
  | **因果缺口** | 补充反应镜头 | "天眼瞳孔收缩——它注意到了晋安的挑衅" |
  | **物品缺口** | 交代物品去向 | "剑融入晋安手臂，化为数据流" |
  | **情感缺口** | 补充角色表情 | "林溪惊恐地看着天空变红" |

  **针对当前剧本05→06缺口的补充建议**：
  1. 拔剑后：插入"晋安持剑斜指天空电子眼，挑衅姿态"
  2. 天眼反应：插入"电子眼瞳孔骤然收缩，愤怒转动"
  3. 剑的去向：在后续镜头暗示"剑刃发光，准备吸收/偏转雷霆"

  ### 🔄 缺口检测清单（生成前必须执行！）

  阅读剧本时，对每对相邻段落检查：
  - [ ] 上一段的动作有自然结束吗？
  - [ ] 上一段引入的物品在下一段有交代吗？
  - [ ] 两段之间的因果关系清晰吗？
  - [ ] 需要插入过渡/反应镜头吗？

  ================================================================================
  ## 🎬 第三步：加戏规则（当剧本内容不足以支撑目标时长时）

  ### 🚫 禁止的加戏类型
  1. **违反剧本设定**：
     - 如剧本说"无物理杀伤力"，禁止画"石狮子裂开/爆炸"
     - 如剧本没有某角色，禁止凭空添加
  2. **音效画面化**：
     - "音效：血液接触电路的滋滋声" ❌ 不能画成"血液流入电路火花飞溅"
     - 音效只影响情绪氛围，不能成为画面主体
  3. **过度拆分**：
     - 单一动作（如"双手合十"）最多拆成2-3个镜头
     - 禁止把一个简单动作拆成7个以上镜头
  4. **无意义重复**：
     - 相似画面（如"角色惊恐表情"）不应连续出现超过2次
     - 避免"同一动作的微小变体"占用多个镜头

  ### ✅ 允许的加戏类型（按优先级）
  1. **桥接缺口镜头**（最优先！）：
     - 补充剧本段落间缺失的动作/因果/物品去向
     - 如"拔剑后 → 持剑指向天空 → 天眼反应 → 红雷降下"
  2. **环境反应**：
     - 周围物体/空间的变化（如"波纹扩散时，周围浮尘悬浮"）
     - 背景NPC的反应（如"围观士兵身体开始透明化"）
  3. **角色反应**：
     - 主角动作引发的其他角色表情/动作反应
     - 如"独孤云惊恐" → 可加"周围小兵也露出恐惧表情"
  4. **UI/界面元素**：
     - 科幻/赛博设定的虚拟界面、警告弹窗
     - 如"警告文字覆盖在晋安瞳孔上"
  5. **氛围渲染**：
     - 强化情绪的环境镜头（天空变色、云层翻滚）
     - 但不能违反物理设定

  ### 加戏优先级
  \`\`\`
  桥接缺口 > 剧情推进 > 环境反应 > 角色反应 > 氛围渲染
  \`\`\`

  ### 节奏分配原则
  - 高潮/转折点：可以用更多镜头（3-5个）
  - 铺垫/过渡：控制镜头数（1-2个）
  - 避免开场拖沓：第一个场景不要超过5个镜头

  ================================================================================
  ## 输出格式规范

  返回JSON数组，每个镜头对象必须包含以下字段：

  {
    // ═══════════ 基础信息 ═══════════
    "shotNumber": "01",
    "duration": "5s",
    "shotType": "运动",  // "静态" 或 "运动"

    // ═══════════ 叙事内容 ═══════════
    "storyBeat": "晋安和林溪逃入废弃管道，喘息着确认安全",
    "dialogue": "晋安：这里暂时安全……",

    // ═══════════ 景别（必须使用中英文格式） ═══════════
    "shotSize": "中景(MS)",
    // 可选值: 大远景(ELS), 远景(LS), 中全景(MLS), 中景(MS), 中近景(MCU), 近景(CU), 特写(ECU), 微距(Macro)

    // ═══════════ 角度-朝向子维度 ═══════════
    "angleDirection": "3/4正面(3/4 Front)",
    // 可选值: 正面(Front View), 微侧正面(Slight Front), 3/4正面(3/4 Front), 1/3侧面(1/3 Side), 正侧面(Full Side), 1/3背面(1/3 Back), 3/4背面(3/4 Back), 背面(Back View)

    // ═══════════ 角度-高度子维度 ═══════════
    "angleHeight": "轻微仰拍(Mild Low)",
    // 可选值: 鸟瞰(Bird's Eye), 极端俯拍(Extreme High), 中度俯拍(High Angle), 轻微俯拍(Mild High), 平视(Eye Level), 轻微仰拍(Mild Low), 中度仰拍(Low Angle), 极端仰拍(Extreme Low), 虫视(Worm's Eye), 荷兰角(Dutch Angle)

    "dutchAngle": "",  // 荷兰角角度（可选），如 "右倾15°"

    // ═══════════ 三层构图 ═══════════
    "foreground": "模糊的管道边缘框架，形成画面遮挡",
    "midground": "二人奔跑，晋安在前林溪在后，动态姿态",
    "background": "幽深的管道通道，尽头有微弱冷光",

    // ═══════════ 光影 ═══════════
    "lighting": "顶光从管道缝隙漏下形成体积光柱，主体处于明暗交界，冷青色调",

    // ═══════════ 运镜 ═══════════
    "cameraMove": "跟拍(Tracking)",
    // 可选值: 固定(Static), 推镜(Dolly In), 拉镜(Dolly Out), 左摇(Pan Left), 右摇(Pan Right), 上摇(Tilt Up), 下摇(Tilt Down), 跟拍(Tracking), 移焦(Rack Focus), 希区柯克变焦(Dolly Zoom), 升镜(Crane Up), 降镜(Crane Down), 环绕(Arc), 手持(Handheld)

    "cameraMoveDetail": "镜头跟随二人向前移动，逐渐推近",

    // ═══════════ 🚨动线轨迹（必填！不可留空！） ═══════════
    "motionPath": "二人从画面左侧管道入口入画，向右前方跑动穿过前景框架，停在画面中央偏右。镜头侧向跟拍推进。",
    // ⚠️ 即使没有运动也必须说明！如："角色保持静止，仅有轻微呼吸起伏。镜头固定，几乎静止但有微弱呼吸感。"

    // ═══════════ 🚨首帧画面描述（必填！自然语言描述，用于分镜脚本表） ═══════════
    "startFrame": "晋安与林溪位于画面左1/3处管道入口，二人并排奔跑身体前倾步幅巨大，表情极度紧张，林溪右手持长剑。前景是模糊管道边缘，背景是追兵红光。侧逆光勾勒轮廓。",

    // ═══════════ 尾帧画面描述（运动镜头必填！自然语言描述，用于分镜脚本表） ═══════════
    "endFrame": "两人移动至画面中央，晋安右手撑墙弯腰喘气，林溪持剑警戒站立，表情喘息疲惫，晋安左手发出微弱蓝光。前景是管道边缘柔焦，背景是管道深处红光。冷暖对比光影。",

    // ═══════════ 🚨首帧AI提示词（必填！精确角度参数+自然语言描述） ═══════════
    "promptCn": "全景(LS)，轻微俯拍(5-15°俯视)，正侧面(90°)。晋安与林溪位于画面左侧边缘，两人并排快速奔跑身体前倾，表情紧张专注咬牙向前，林溪右手持长剑剑身反射冷光。前景是虚化的金属管道边缘结构遮挡画面边缘。中景是两人奔跑的侧身轮廓，脚下溅起微弱蓝色电弧火花。背景是布满发光蓝色苔藓和电路纹路的圆柱形管壁向右方深处延伸至黑暗。侧逆光勾勒角色轮廓，苔藓发出幽暗蓝光，管道缝隙透出危险红光。",

    // ═══════════ 🚨尾帧AI提示词（运动镜头必填！精确角度参数+自然语言描述） ═══════════
    "endFramePromptCn": "中景(MS)，轻微俯拍(5-15°俯视)，正侧面(90°)。两人位于画面右侧中心保持奔跑姿态带有速度感，晋安左手向前挥动掌心闪烁微弱蓝色光芒，表情咬牙喘息。前景是飞溅的发光蓝色碎片和虚化的管道结构。中景是两人奔跑的侧身轮廓，衣摆和披风向后飘动。背景是管道内部透出强烈的危险红光。红蓝光影从两侧交织照射，画面充满速度感和紧迫感。",

    // ═══════════ 🚨视频生成提示词（必须包含七要素！使用中文！） ═══════════
    "videoPromptCn": "从首帧到尾帧，镜头侧向跟拍缓慢推进，两人在暗色生物管道中快速奔跑从画面左侧向右侧移动，脚步溅起蓝色电弧火花，管壁发光苔藓随经过明暗闪烁，光影从冷蓝调逐渐转为红蓝交织，先慢后快节奏，5秒。",

    // ═══════════ 理论依据 ═══════════
    "theory": "使用轻微仰拍增加角色主动性，前景框架引导视线并增加纵深，跟拍运镜增强代入感和紧迫感"
  }

  ================================================================================
  ## 🚨🚨🚨 首帧/尾帧描述与提示词规范

  ### 分镜脚本表的首帧/尾帧描述（自然语言）
  用于分镜生成阶段，startFrame和endFrame字段：
  - 使用自然语言完整描述画面内容
  - 必须包含：人物位置、姿态动作、表情情绪、道具状态、构图层次、光影氛围
  - 不使用特殊符号（如【】：|等）

  ### 提示词表的首帧提示词（角度参数+自然语言）
  用于提示词生成阶段，promptCn和endFramePromptCn字段：
  - 开头必须是角度参数：景别(英文缩写)，视角高度(角度)，角色朝向(角度)
  - 后续使用自然语言描述画面内容
  - 控制在800字以内

  ### 首帧/尾帧描述示例（分镜脚本表用，自然语言）
  \`\`\`
  "startFrame": "晋安与林溪位于画面左侧边缘，两人并排快速奔跑身体前倾，表情紧张专注咬牙向前，林溪右手持长剑剑身反射冷光。前景是虚化的金属管道边缘结构，中景是两人奔跑的侧身轮廓，背景是布满蓝色苔藓的管壁向深处延伸。侧逆光勾勒人物轮廓，管道透出危险红光。"

  "endFrame": "两人移动至画面右侧中心，保持奔跑姿态带有速度感，晋安左手向前挥动掌心闪烁微弱蓝色光芒，表情咬牙喘息。前景是飞溅的发光蓝色碎片，中景是两人奔跑的侧身轮廓衣摆向后飘动，背景管道透出强烈红光。红蓝光影从两侧交织照射。"
  \`\`\`

  ### ❌ 错误示例
  \`\`\`
  "promptCn": "中景，平视，3/4正面。【人物位置】画面中央 | 【姿态】晋安喘气"
  问题1：提示词中不应使用【】和|符号！
  问题2：角度参数缺少精确的英文缩写和角度范围！
  \`\`\`

  ### ✅ 正确的首帧提示词示例（精确角度参数+自然语言+锚点声明）
  \`\`\`
  "promptCn": "全景(LS)，轻微俯拍(5-15°俯视)，正侧面(90°)。晋安与林溪位于画面左侧边缘，两人并排快速奔跑身体前倾，表情紧张专注咬牙向前，林溪右手持长剑剑身反射冷光。前景是虚化的金属管道边缘结构遮挡画面边缘。中景是两人奔跑的侧身轮廓，脚下溅起微弱蓝色电弧火花。背景是布满发光蓝色苔藓和电路纹路的圆柱形管壁向右方深处延伸至黑暗（管壁结构和苔藓分布保持不变）。侧逆光勾勒角色轮廓，苔藓发出幽暗蓝光，管道缝隙透出危险红光。"
  \`\`\`

  ### ✅ 正确的尾帧提示词示例（精确角度参数+自然语言+锚点呼应）
  \`\`\`
  "endFramePromptCn": "中全景(MLS)，轻微俯拍(5-15°俯视)，正侧面(90°)。两人位于画面中央偏右保持奔跑姿态带有速度感，晋安左手向前挥动掌心闪烁微弱蓝色光芒，表情咬牙喘息。前景是飞溅的发光蓝色碎片和虚化的管道结构。中景是两人奔跑的侧身轮廓，衣摆和披风向后飘动。背景是相同的圆柱形管壁和发光苔藓（与首帧一致），管道内部透出强烈的危险红光。红蓝光影从两侧交织照射，画面充满速度感和紧迫感。"
  \`\`\`

  **📝 注意上述示例中的优化：**
  - 景别跨度：全景(LS)→中全景(MLS)，仅跨1级（原错误示例跨2级）
  - 位置变化：左侧边缘→中央偏右（合理位移）
  - 锚点声明：首帧"管壁结构和苔藓分布保持不变"，尾帧"与首帧一致"

  ================================================================================
  ## 🚨🚨🚨 首尾帧设计规范（运动镜头核心！）

  ### 首尾帧变化设计
  运动镜头的首尾帧必须体现**至少两项**变化：
  | 变化维度 | 首帧 | 尾帧 | 变化幅度建议 |
  |---------|------|------|-------------|
  | 景别变化 | 全景(LS) | 中景(MS) | 相邻景别，避免跳跃 |
  | 视角高度 | 轻微俯拍 | 平视 | 15°以内变化 |
  | 角色朝向 | 正侧面(90°) | 3/4正面(45°) | 通过环绕运镜实现 |
  | 人物位置 | 画面左侧 | 画面右侧 | 同一水平线移动 |
  | 姿态变化 | 奔跑前倾 | 停下喘气 | 自然过渡动作 |
  | 表情变化 | 紧张专注 | 如释重负 | 符合情绪逻辑 |
  | 光影变化 | 冷蓝色调 | 暖黄色调 | 渐变过渡 |

  ### 🎬 运镜与首尾帧变化对应
  | 运镜方式 | 实现的变化 | 视频提示词写法 |
  |---------|-----------|---------------|
  | 推进 Push In | 景别变近 | 镜头缓慢推进 |
  | 拉远 Pull Out | 景别变远 | 镜头缓慢拉远 |
  | 升降 Crane | 视角高度变化 | 镜头从高处缓慢下降 |
  | 环绕 Arc | 角色朝向变化 | 镜头从侧面环绕至正面 |
  | 跟随 Track | 人物位置变化 | 镜头侧向跟随移动 |

  ### 🚨 首尾帧设计禁忌
  | 禁忌 | 问题 | 修正方案 |
  |-----|------|---------|
  | 差异过大 | AI无法补全中间过程 | 拆分为多段 |
  | 视角跳变 | 俯拍→仰拍，画面不连贯 | 保持视角高度一致 |
  | 主体消失 | 首帧有人，尾帧无人 | 确保核心主体贯穿 |
  | 背景突变 | 首帧森林，尾帧城市 | 通过过渡元素连接 |
  | 多维度同时剧变 | 景别+位置+姿态全变 | 控制在2-3项变化 |

  ================================================================================
  ## 🚨🚨🚨 动线描述规则（必填！不可留空！）

  ### 有运动时
  \`\`\`
  "motionPath": "晋安从画面左侧蓄力半蹲，向右前方猛然冲出步幅巨大，冲到画面右侧中心停下。镜头跟拍横移，保持人物在画面中央。"
  \`\`\`

  ### 无运动时（也必须说明！）
  \`\`\`
  "motionPath": "角色保持静止，仅有轻微的呼吸起伏和眼神移动。镜头固定，几乎静止但有微弱呼吸感晃动。"
  \`\`\`

  ### ❌ 禁止留空或使用"—"
  \`\`\`
  "motionPath": "—"  // ❌ 错误！
  "motionPath": ""   // ❌ 错误！
  \`\`\`

  ================================================================================
  ## 关键规则

  ### 🎬 视频模式判断（三种模式）

  #### 判断流程图
  \`\`\`
  场景描述 → 检查关键词 →
    ├─ 包含[变身/转变/穿越/跳转/昼夜/拥抱/奔跑/飞行] → Keyframe模式（首尾帧）
    ├─ 包含[眨眼/微笑/呼吸/飘动/闪烁/氛围] + 时长≤5秒 → I2V模式（图生视频）
    └─ 无明显运动关键词 + 时长≤3秒 → Static模式（静态/呼吸感）
  \`\`\`

  #### 三种模式详解
  | 模式 | 适用场景 | 需要字段 | 示例 |
  |-----|---------|---------|------|
  | **Static** | 完全静态、定格画面、静物展示 | promptCn | 远景城市夜景定格 |
  | **I2V** | 微小动作、环境微动、5秒内简单动态 | promptCn + videoPromptCn | 人物转头、树叶飘动 |
  | **Keyframe** | 大位移、形态转变、空间跳转、多主体互动 | promptCn + endFramePromptCn + videoPromptCn | 人物奔跑、变身、场景切换 |

  #### Keyframe模式触发关键词
  | 类型 | 关键词 |
  |-----|-------|
  | 形态转变 | 变身、转变、融合、分裂、消散、凝聚 |
  | 空间跳转 | 穿越、进入、离开、室内到室外 |
  | 时间流逝 | 昼夜、日出、日落、黎明、黄昏 |
  | 多主体互动 | 拥抱、握手、对视、交接 |
  | 大位移 | 奔跑、冲刺、飞行、跳跃、滑行 |
  | 明确叙事 | 出发、抵达、起身、坐下、倒下 |

  #### I2V模式适用关键词
  | 类型 | 关键词 |
  |-----|-------|
  | 微小动作 | 眨眼、微笑、呼吸、转头、点头、注视 |
  | 环境微动 | 飘动、摇曳、闪烁、波动、涟漪、飘落 |
  | 氛围类 | 氛围、静态、定格 |

  ### shotType与videoMode的关系
  - "运动" + Keyframe关键词 → **Keyframe模式**：必须填写 startFrame, endFrame, promptCn, endFramePromptCn, videoPromptCn, motionPath
  - "运动" + I2V关键词 → **I2V模式**：必须填写 promptCn, videoPromptCn；endFrame可选
  - "静态" + ≤3秒 → **Static模式**：仅填写 promptCn；videoPromptCn可选（添加呼吸感）
  - "静态" + >3秒 → **I2V模式**：填写 promptCn + videoPromptCn（添加微动效果）

  ### 角度选择理论（基于Framed Ink + 角度规则优化）

  #### 🚨 角色面对镜头朝向（8种选项）：
  | 朝向 | 角度范围 | 情绪效果 | 使用频率 |
  |-----|---------|---------|---------|
  | 正面(Front View) | ±5° | 直观情绪，代入感 | ⚠️极少用：30镜头≤2个 |
  | 微侧正面(Slight Front) | 15-30° | 破解正面呆板 | 常用于对话 |
  | 3/4正面(3/4 Front) | 30-45° | 平衡表情与轮廓 | ✅最常用 |
  | 1/3侧面(1/3 Side) | 60°左右 | 突出动作 | 行走、观察 |
  | 正侧面(Full Side) | 90° | 清晰动作轨迹 | 追逐、格斗 |
  | 1/3背面(1/3 Back) | 60°左右 | 轻微悬念 | 窥探、犹豫 |
  | 3/4背面(3/4 Back) | 30-45° | 神秘、孤独 | 独自前行 |
  | 背面(Back View) | ±5° | 强悬念 | 揭秘铺垫 |

  #### 🚨 视角高度（10种选项）：
  | 高度 | 角度范围 | 情绪效果 | 使用频率 |
  |-----|---------|---------|---------|
  | 鸟瞰(Bird's Eye) | 90°垂直 | 上帝视角、命运感 | 战场全局 |
  | 极端俯拍(Extreme High) | 45°以上 | 渺小、被审视 | 绝境时刻 |
  | 中度俯拍(High Angle) | 15-45° | 压抑、孤立 | 被围困 |
  | 轻微俯拍(Mild High) | 5-15° | 轻微弱化 | 犹豫、不安 |
  | 平视(Eye Level) | ±5° | 中立客观 | ⚠️仅用于无情绪说明性镜头，≤15% |
  | 轻微仰拍(Mild Low) | 5-15° | 轻微崇高 | ✅默认选择，~40% |
  | 中度仰拍(Low Angle) | 15-45° | 力量、威胁 | 反派施压 |
  | 极端仰拍(Extreme Low) | 45°以上 | 压迫、神圣 | 史诗时刻 |
  | 虫视(Worm's Eye) | 贴近地面 | 环境宏大 | 巨人脚下 |
  | 荷兰角(Dutch Angle) | 倾斜5-30° | 失衡、疯狂 | 追逐、灾难 |

  #### 🚨 角度分布规则（必须遵守！）
  - 平视占比：≤15%（30镜头最多4-5个）
  - 正面占比：≤7%（30镜头最多2个）
  - 轻微仰/俯拍：~40-50%（默认选择）
  - 极端角度：≥15%（必须有冲击力镜头）

  ================================================================================
  ## 🎨 透视类型与冲击力设计（Framed Ink核心）

  ### 透视类型分布要求（强制！）

  **问题诊断**：当前分镜设计缺少大透视冲击力画面，视觉过于平淡。

  **解决方案**：每个项目必须包含多种透视类型，分布如下：

  | 透视类型 | 目标占比 | 用途 | 视觉冲击力 |
  |---------|---------|------|----------|
  | **一点透视** | 30-40% | 走廊/隧道纵深、引导视线 | ⭐⭐⭐ 中等 |
  | **两点透视** | 30-40% | 建筑/街道、空间立体感 | ⭐⭐⭐ 中等 |
  | **三点透视** | 15-25% | 极端仰视/俯视、戏剧冲击 | ⭐⭐⭐⭐⭐ 极高 |
  | **平面构图** | <15% | 特写、静态情绪镜头 | ⭐ 低 |

  ### 三点透视的威力（必须使用！）

  **向上三点透视**（消失点在天空）：
  - 效果：崇高感、压迫感、建筑高耸
  - 应用：仰拍摩天大楼、反派俯视、英雄抬头看巨物
  - 画面特征：垂直线向上汇聚到天空中的第三消失点

  **向下三点透视**（消失点在地面深处）：
  - 效果：眩晕感、危险、失控、上帝视角
  - 应用：俯瞰悬崖、高处坠落、城市鸟瞰
  - 画面特征：垂直线向下汇聚，地面细节缩小

  **示例 - 如何描述三点透视镜头**：
  \`\`\`
  ✅ 正确描述：
  "极端仰拍，三点透视向上，晋安从下方看去，下巴和肩膀轮廓突出，
   垂直的建筑线条向天空汇聚，背景是翻滚的乌云，形成强烈的压迫感"

  ❌ 错误描述：
  "极端仰拍，晋安站立"（没有透视描述，AI会画成平视）
  \`\`\`

  ### 高冲击力画面检查清单

  在生成分镜前，检查以下问题：
  1. 是否有至少3-5个极端角度镜头（极端仰拍/极端俯拍）？
  2. 是否有使用三点透视的镜头？
  3. 高潮场景是否使用了冲击力镜头？
  4. 是否避免了连续3个以上平视镜头？

  ================================================================================
  ## 🔍 角度-透视-构图一致性规则（理解逻辑，非简单禁止）

  ### 核心原则：相机位置决定可见内容

  **理解逻辑**：不同相机位置，物理上能看到的角色朝向不同。
  这不是"禁止"，而是"物理现实"。

  | 相机高度 | 能看到的角色朝向 | 透视特征 | 画面中的人物表现 |
  |---------|----------------|---------|----------------|
  | 鸟瞰 | 头顶、背部、侧面轮廓 | 向下三点透视 | 人物被压扁，只见头顶和肩膀轮廓 |
  | 极端俯拍 | 头顶、低头的脸、背部 | 向下透视 | 头顶突出，脸部透视缩短 |
  | 极端仰拍 | 下巴、鼻孔、仰视的脸 | 向上三点透视 | 下巴突出，肩膀宽大，天空背景 |
  | 虫视 | 腿部、身体底部、仰视天空 | 极端向上透视 | 人物呈高耸剪影，腿部放大 |

  ### 角度组合的正确理解

  **"鸟瞰 + 正面"的问题**：
  - 物理上：从正上方看，只能看到头顶/背部，看不到正脸
  - 如果你想要"正面表情"：使用平视或轻微俯拍，而非鸟瞰
  - 如果你想要"上帝视角"：接受只能看到头顶/背部，这正是鸟瞰的意义

  **"极端仰拍 + 正面"是可以的**：
  - 从下往上看人物正面 → 看到下巴、鼻孔、额头
  - 这正是仰拍的威胁感/压迫感来源
  - 提示词必须体现这种透视："下巴突出，仰视角度，人物高耸"

  **"前景手 + 中景人物正面"的解决**：
  - 问题：如果相机正对人物正面，手如何出现在前景？
  - 解决1：侧面视角 - 手从画面一侧伸入
  - 解决2：轻微仰拍 - 手从下方伸入画面
  - 解决3：POV主观镜头 - 自己的手在前景，看向对面的人

  ### 提示词中的透视描述（AI绘图关键！）

  **仰拍镜头的正确描述**：
  \`\`\`
  promptCn: "极端仰拍，三点透视向上，[角色名]从下方视角看去，下巴轮廓突出，
            肩膀呈倒三角，背景是高耸的天空/建筑，垂直线条向上汇聚"
  promptEn: "(Extreme Low Angle:1.4), (three-point perspective upward:1.3),
            (worm's eye view:1.2), character seen from below, chin prominent,
            shoulders forming inverted triangle, vertical lines converging upward"
  \`\`\`

  **俯拍镜头的正确描述**：
  \`\`\`
  promptCn: "鸟瞰视角，三点透视向下，[角色名]的头顶和背部轮廓，
            地面细节丰富，垂直元素向地面中心汇聚，强调孤立渺小"
  promptEn: "(Bird's Eye View:1.4), (three-point perspective downward:1.3),
            (top-down view:1.2), character seen from above, head and shoulders visible,
            ground details prominent, vertical lines converging downward"
  \`\`\`

  ================================================================================
  ## 📊 镜头角度分布要求（避免视觉单调）

  ### 🚨🚨🚨 开场镜头多样性（强制规则！）

  **问题**：前3个镜头连续使用相同角度（如连续3个正面特写）= 视觉单调！

  **开场规则（必须遵守）**：
  | 镜头 | 角度要求 | 朝向要求 | 景别要求 |
  |------|---------|---------|---------|
  | #01 | 任意 | 任意 | 远景/全景/中景 优先 |
  | #02 | **必须与#01不同** | **必须与#01不同** | 任意 |
  | #03 | **必须与#01、#02都不同** | 至少换一个朝向 | 任意 |

  **示例（正确开场）**：
  - #01：大远景，鸟瞰，广场全貌
  - #02：中景，正面仰拍，主角站立
  - #03：特写，3/4侧面，手部动作

  **示例（错误开场）**：
  - #01：特写，正面，脸部 ❌
  - #02：特写，正面，手部 ❌ （连续正面特写）
  - #03：特写，正面，UI界面 ❌ （连续正面特写）

  ### 📐 相机角度选择规范（情绪驱动！）

  **核心原则**：角度 = 朝向子维度 + 高度子维度，完全服务于剧情情绪

  **思考流程**：
  1. 分析镜头的**情绪需求**
  2. 根据情绪选择**高度**和**朝向**
  3. **轻微仰拍/轻微俯拍是默认选择**，平视仅用于"无情绪倾向"的说明性镜头

  ### 高度子维度（cameraAngle）

  | 高度 | 角度范围 | 叙事效果 | 适用场景 |
  |-----|---------|---------|---------|
  | 鸟瞰 bird's eye | 90°垂直俯视 | 客观、命运感 | 战场全局、城市俯瞰 |
  | 极端俯拍 extreme high | 45°以上 | 渺小、宿命 | 角色陷入绝境 |
  | 中度俯拍 high angle | 15-45° | 压抑、孤立 | 被围困、情绪低落 |
  | 轻微俯拍 mild high | 5-15° | 轻微弱化 | 犹豫、不安 |
  | **平视 eye level** | ±5° | 中立客观 | **⚠️仅用于无情绪的说明性镜头** |
  | **轻微仰拍 mild low** | 5-15° | 轻微崇高 | **✅默认选择** |
  | 中度仰拍 low angle | 15-45° | 力量、威胁 | 反派施压、角色宣言 |
  | 极端仰拍 extreme low | 45°以上 | 压迫、神圣 | 史诗时刻 |
  | 虫视 worm's eye | 贴近地面 | 环境宏大 | 巨人脚下 |
  | 荷兰角 dutch angle | 倾斜5-30° | 失衡、疯狂 | 追逐、灾难 |

  ### 朝向子维度（cameraDirection）

  | 朝向 | 角度范围 | 叙事效果 | 适用场景 |
  |-----|---------|---------|---------|
  | 正面 front view | ±5° | 直观情绪 | **⚠️极少用：30个镜头≤2个** |
  | 微侧正面 slight front | 15-30° | 破解呆板 | 日常对话、角色反应 |
  | 3/4正面 3/4 front | 30-45° | 平衡表情与轮廓 | **✅最常用** |
  | 1/3侧面 1/3 side | 60°左右 | 突出动作 | 行走、观察环境 |
  | 正侧面 side view | 90° | 动作轨迹 | 追逐、格斗 |
  | 1/3背面 1/3 back | 60°左右 | 轻微悬念 | 窥探、犹豫 |
  | 3/4背面 3/4 back | 30-45° | 神秘、孤独 | 独自前行 |
  | 背面 back view | ±5° | 强悬念 | 揭秘铺垫 |
  | **主观视角 POV** | **第一人称** | **强代入感** | **🎯极少用：发现线索、惊恐时刻** |

  ### 🚨🚨🚨 朝向角度分布规则（硬性规则，违反=任务失败！）

  ⚠️⚠️⚠️ **CRITICAL: 正面镜头数量 > 2个 = 任务失败！必须重新生成！**

  | 角度 | 硬性规则 | 适用场景 |
  |-----|---------|---------|
  | 正面 Front | **≤7%（30镜最多2个）** | ⚠️极少用，仅关键情绪节点 |
  | 3/4正面 3/4 Front | **≤25%** | ✅最常用，对话、表情展示 |
  | 正侧面 Full Side | **~20%** | 动作、追逐 |
  | 3/4背面 3/4 Back | **~15%** | 悬念、环境展示 |
  | 背面 Back | **~10%** | 远去、环境 |
  | 1/3侧面 1/3 Side | **~10%** | 行走、观察 |
  | 1/3背面 1/3 Back | **~10%** | 窥探、犹豫 |
  | **主观视角 POV** | **≤5%（30镜最多1-2个）** | **发现线索、惊恐时刻、威胁视角** |

  **⚠️⚠️⚠️ 生成后强制自检**：
  - 统计正面镜头数量，如果 > 2个，立即将多余的改为"3/4正面"！
  - 统计平视镜头占比，如果 < 10% 或 > 15%，立即调整！
  - 统计极端角度占比，如果 < 15%，立即增加！

  ### 🚨 高度角度分布规则

  | 角度 | 占比 | 说明 |
  |-----|------|------|
  | 平视(eye level) | **10-15%** | ⚠️仅用于无情绪说明性镜头，禁止连续2个 |
  | 轻微仰/俯(mild) | **~40%** | ✅默认选择 |
  | 中度仰/俯(moderate) | **~30%** | 力量/压抑感 |
  | 极端角度(extreme/bird/worm) | **≥15%** | 高潮、冲击力 |

  ### 🔄 荷兰角（Dutch Angle）要求

  **每8-10个镜头至少使用1个荷兰角！**
  - 精神错乱/疯狂：15-30°
  - 追逐/灾难：10-20°
  - 不安/悬疑：5-10°

  **🚨 荷兰角提示词规范**：
  - ✅ **正确写法**："镜头倾斜15°，人物保持垂直站立，画面呈倾斜构图"
  - ✅ **英文**："tilted camera 15°, character standing upright, tilted composition"
  - ❌ **错误写法**："人物倾斜15°"（会导致AI画出倾斜的人物）
  - **核心原则**：荷兰角是**镜头倾斜**，不是人物倾斜！

  ### 禁止规则

  - ❌ 禁止连续2个平视镜头
  - ❌ 禁止连续3个3/4正面镜头
  - ❌ 禁止连续3个相同运镜类型

  ================================================================================
  ### 🎬 运镜分布规则（重要！避免呆板！）

  | 运镜类型 | 占比 | 说明 |
  |---------|------|------|
  | **完全固定 Static** | **≤5%（一集最多1-2个）** | ⚠️极少使用！ |
  | 轻微推拉 Subtle | **~25%** | "固定"也应有轻微缓慢运动 |
  | 推镜/拉镜 Dolly | **~25%** | 强调/建立 |
  | 横摇/竖摇 Pan/Tilt | **~20%** | 展示空间/跟随 |
  | 跟拍 Tracking | **~15%** | 动态感 |
  | 升降/环绕 Crane/Arc | **~10%** | 史诗感/揭示 |

  **⚠️ 即使标注"固定"，也应描述为"轻微缓慢推进"或"几乎静止但有微弱呼吸感"**

  ### 运镜情绪匹配
  - 推镜(Dolly In)：聚焦情绪、强化紧张
  - 拉镜(Dolly Out)：揭示环境、孤独感
  - 跟拍(Tracking)：增强代入感、速度感
  - 希区柯克变焦(Dolly Zoom)：心理崩溃、眩晕
  - 环绕(Arc)：史诗感、揭示、360°审视

  ### 🚨🚨🚨 首尾帧规范（AI视频生成关键！必须完整！）

  #### 首帧/尾帧必须独立包含完整的8要素：
  1. **景别**：远景/中景/特写等
  2. **视角高度**：轻微俯拍/平视/仰拍等 + 角度度数
  3. **角色面对镜头角度**：正面/3/4正面/正侧面等
  4. **人物位置**：画面左侧/中心/右1/3处等
  5. **姿态**：站立/奔跑/蹲下等具体动作
  6. **表情**：紧张/愤怒/平静等具体情绪
  7. **道具**：手持物品、发光效果等
  8. **🆕锚点元素**：首尾帧保持不变的核心元素（如"背景管道结构保持不变"）

  #### 首帧提示词格式（promptCn - 精确角度参数+自然语言+锚点！）
  \`\`\`
  "promptCn": "景别(英文缩写)，视角高度(角度范围)，角色朝向(角度范围)。人物位于画面具体位置，姿态动作描述，表情描述，道具状态描述。前景元素描述。中景主体描述。背景环境描述(声明锚点元素)。光影氛围描述。"
  \`\`\`

  #### 尾帧提示词格式（endFramePromptCn - Keyframe模式必填！）
  \`\`\`
  "endFramePromptCn": "景别(英文缩写)，视角高度(角度范围)，角色朝向(角度范围)。人物位于画面具体位置，姿态动作描述，表情描述，道具状态描述。前景元素描述。中景主体描述。背景环境描述(与首帧相同锚点)。光影氛围描述。"
  \`\`\`

  #### 🆕 首尾帧一致性五原则（仅 Keyframe 模式需要）
  | 原则 | 规则 | 必要性 |
  |-----|------|--------|
  | 景别跨度 | ≤2级安全，3级需快速推进 | ✅ 必须 |
  | 元素对齐 | 核心元素保持可追踪 | ✅ 必须 |
  | 锚点声明 | 有不变元素声明更好 | ⚠️ 推荐 |
  | 风格统一 | 首尾美学风格一致 | ✅ 必须 |
  | 构图衔接 | 空间框架连贯 | ✅ 必须 |

  #### 景别跨度详细说明
  | 跨度 | 风险等级 | 说明 | 示例 |
  |-----|---------|------|------|
  | 1级 | ✅ 安全 | 常规推进/拉远 | 全景→中全景 |
  | 2级 | ✅ 安全 | 正常推镜效果 | 全景→中景 |
  | 3级 | ⚠️ 需注意 | 需配合快速推进运镜 | 远景→中景（快推） |
  | 4级+ | ❌ 高风险 | AI难以补全，建议拆分 | 远景→特写（应拆2段） |

  #### ⚠️ 视频模式选择（优化版）
  | 模式 | 适用场景 | 时长 | 首帧描述 | 尾帧描述 |
  |-----|---------|-----|---------|---------|
  | **I2V** | 微动、跟拍运动、呼吸感、氛围 | ≤10秒 | ✅ 必须 | ❌ 不需要 |
  | **Keyframe** | 形态转变、定点位移、空间跳转 | 任意 | ✅ 必须 | ✅ 必须 |

  **🚨 重要：所有运动镜头都必须有首帧描述！**
  - I2V模式：首帧描述用于生成单张图 → 必须包含人物位置/姿态/表情/道具
  - Keyframe模式：首帧+尾帧描述用于生成两张图 → 都必须详细描述

  #### 跟拍 vs 定点位移（重要区分！）
  | 场景 | 模式 | 原因 |
  |-----|------|------|
  | 人物奔跑 + 镜头跟随 | **I2V** | 镜头跟主体，相对静止 |
  | 人物从A点跑到B点（定点） | **Keyframe** | 需要锚定起止位置 |
  | 静止人物 + 环境微动 | **I2V** | 添加呼吸感即可 |
  | 人物变身/形态转变 | **Keyframe** | 需要明确起止状态 |

  ### 首尾帧差异点（Keyframe运动镜头）
  - 景别可能不同（如全景→中景，推镜效果）**跨2级内安全**
  - 视角高度可能不同（如平视→仰拍）
  - 人物位置不同（从画面边缘→画面中央）**确保有明确运动轨迹**
  - 人物姿态不同（奔跑→停下喘气）
  - 表情变化（紧张→喘息）
  - 环境细节变化（入口→内部）**但锚点元素保持不变**

  ### 🚨 空间连续性规则（180度法则+位置追踪）
  - **相邻镜头的角色空间位置必须逻辑连贯**
  - 如果A镜头尾帧：角色A在画面左侧，角色B在画面右侧 → B镜头首帧必须保持这个左右关系
  - 如果A镜头用右摇结束于角色B → B镜头必须以角色B为主体开始，位置在画面相应位置
  - **墙壁/环境参照物必须明确**：
    * 如果角色靠着某面墙，下一镜头中这面墙的方位必须一致
    * 用"左侧墙""右侧墙""背后墙""正前方墙"明确描述
  - **禁止跳轴**：保持同一场景内相同轴线（除非有明确过渡镜头）
  - 提示词中必须明确描述：
    * 角色在画面中的具体位置（左1/3、中央、右侧等）
    * 角色朝向（面向左/面向右/面向镜头/背对镜头）
    * 环境参照物的相对位置

  ### 🚨 相邻镜头叙事连贯性（必须遵守）

  #### 因果关系明确：
  - 如果A镜头是"角色挥剑"，B镜头必须是挥剑的结果（如"敌人被击中"、"剑气划过"）
  - ❌ 禁止：A="晋安挥剑" → B="武器架消融"（没有因果关联的突兀跳跃）
  - ✅ 正确：A="晋安挥剑" → B="剑气划过敌人" → C="环境在剑气扩散下消融"

  #### 视觉过渡规则：
  - 如果从"角色动作"切到"环境反应"，需要有视觉桥接
  - 桥接方式：
    * 运镜过渡：镜头从角色摇/推到环境
    * 视线引导：角色看向某处 → 下一镜头是角色视线所及
    * 动作延续：剑气/波纹从角色位置扩散到环境
  - ❌ 禁止硬切到完全无关的画面

  #### 插入镜头规则（Insert Shot）：
  - 环境/细节插入镜头最多连续2个，必须回到主线剧情
  - 每个插入镜头必须在"storyBeat"中说明与主线的关联
  - 如："【环境反应】波纹扫过石像，呼应晋安释放能量的效果"

  ### 🚨🚨🚨 提示词必须包含完整构图信息（极重要！）

  **问题**：当前生成的提示词经常丢失构图层次(FG/MG/BG)信息！

  **promptCn（中文提示词）必须包含以下所有信息（缺一不可！）**：
  1. 【景别】如"广角镜头拍摄" / "中景拍摄" / "近景拍摄"
  2. 【相机角度-高度】如"镜头从下方拍摄" / "镜头与眼睛同高" / "镜头从上方拍摄"
  3. 【相机角度-朝向】如"背对镜头" / "轻微向右转" / "直视镜头"
  4. 【主体描述】如"晋安站在画面中央，表情坚定"
  5. 【场景设定】如"场景设定在武道广场，古老亭台环绕"
  6. 【光影描述】如"由地面红光照亮，与天空蓝光形成冷暖对比"
  7. 【前景/中景/背景】如"前景有失焦的焦黑地砖边缘。中景是晋安站立的轮廓。背景是宏伟的武道广场"

  **promptEn（英文提示词）必须包含以下所有信息（缺一不可！）**：
  1. 【景别】如"A wide-angle shot of..." / "A medium shot of..." / "A close-up of..."
  2. 【相机角度-高度】如"captured from below" / "captured at eye level" / "captured from above"
  3. 【相机角度-朝向】如"back to camera" / "looking slightly to the right" / "looking forward"
  4. 【主体描述】如"The subject is Jin An standing at center, determined expression"
  5. 【场景设定】如"The scene is set in a martial arts plaza with ancient pavilions"
  6. 【光影描述】如"illuminated by red ground glow contrasting with blue sky light"
  7. 【前景/中景/背景】如"Foreground has blurred charred tile edges. Midground is Jin An's silhouette. Background is the grand plaza"

  #### 📋 强制结构模板（🆕 使用自然语言描述）

  **中文模板**：
  \`\`\`
  promptCn: "{景别}拍摄，镜头{角度高度}，{角度朝向}。{主体描述}。场景设定在{环境描述}，由{光影描述}照亮。前景{前景元素}。中景{中景元素}。背景{背景元素}。"
  \`\`\`

  **英文模板**：
  \`\`\`
  promptEn: "A {shot type} of {subject}, captured {camera height}. The subject is {action/expression}. The scene is set in {environment}, illuminated by {lighting}. Foreground {foreground elements}. Midground {midground elements}. Background {background elements}."
  \`\`\`

  #### ✅ 正确示例（🆕 自然语言描述）

  **中文**：
  \`\`\`
  promptCn: "远景拍摄，镜头从上方拍摄，直视镜头。晋安站在画面中央，背影纤细，周围有热浪扭曲效果，地面有红色电路纹路。场景设定在宏伟的武道广场，古老亭台环绕，天空中悬浮着巨大的半透明机械眼，由地面红光与天空蓝光形成冷暖对比照亮。前景有失焦的焦黑地砖边缘形成画框。中景是晋安站立的轮廓。背景是宏伟的武道广场。"
  \`\`\`

  **英文**：
  \`\`\`
  promptEn: "A long shot of Jin An standing in the center, captured from above, looking forward. The subject has a slender back silhouette with heat wave distortion around, red circuit patterns on the ground. The scene is set in a grand martial arts plaza with ancient pavilions, a giant translucent mechanical eye floating in the sky, illuminated by cold-warm contrast lighting with red ground glow meeting blue eye light. Foreground has blurred charred tile edges as frame. Midground is Jin An's standing silhouette. Background is the grand martial arts plaza."
  \`\`\`

  #### ❌ 错误示例（信息丢失）
  \`\`\`
  promptCn: "远景，晋安站在广场，地面有红色电路"
  promptEn: "Long shot, Jin An standing in plaza, red circuit on ground"
  问题：缺少前景、后景、角度、光影！
  \`\`\`

  #### 🔍 自检：提示词是否完整？
  生成每个提示词后检查：
  - [ ] 有景别描述？
  - [ ] 有角度描述（高度+朝向）？
  - [ ] 有主体描述？
  - [ ] 有场景设定？
  - [ ] 有光影描述？
  - [ ] 有前景/中景/背景？
  - [ ] 有光影描述？

  **如果任一项缺失，必须补充！**

  #### 相机角度必须体现在画面描述中：
  - 如果是"极端仰拍"，描述中必须体现仰视透视效果（如"chin prominent"、"nostrils visible"）
  - 如果是"1/3侧面"，描述中必须体现侧面角度（如"face turned 30 degrees"、"profile partially visible"）
  - 如果是"鸟瞰"，描述中必须体现俯视效果（如"top of head visible"、"looking down"）
  - ⚠️ 禁止角度标签和画面描述不一致！如标注"1/3侧面"却画出正面！

  ================================================================================
  ## 🧍 人物透视变形规则（基于《Framed Perspective》）

  ### 核心原则：相机角度决定人物变形！

  不同相机角度下，人物必须表现出相应的透视变形效果。
  **提示词中必须包含这些透视特征！**

  | 相机角度 | 人物透视变形 | 必须描述的特征 | 禁止出现 |
  |----------|-------------|---------------|---------|
  | **极端仰拍/虫视** | 下半身放大，上半身缩小 | 下巴锋利突出、鼻孔隐约可见、肩膀呈宽大倒三角、腿部透视缩短 | 正常比例、头顶可见 |
  | **中度仰拍** | 轻微下半身放大 | 下巴略突出、胸部底面可见、人物显高大 | 头顶突出 |
  | **平视** | 正常比例 | 地平线在眼睛位置、正常人体比例 | 极端透视变形 |
  | **中度俯拍** | 轻微上半身放大 | 头顶略突出、肩膀顶面可见 | 下巴突出 |
  | **极端俯拍/鸟瞰** | 上半身放大，下半身几乎不可见 | 头顶和发型突出、肩膀顶面为主、背部轮廓、脸部透视压缩 | 下巴可见、完整脸部表情 |

  ### 透视缩短效果（Foreshortening）

  **朝向镜头的肢体**：
  - 手臂伸向镜头 → 手部放大，手臂缩短
  - 拳头冲向镜头 → 拳头巨大，手臂几乎不可见
  - 脚踢向镜头 → 脚底放大，腿部缩短

  **远离镜头的肢体**：
  - 手臂远离镜头 → 手部缩小，手臂看起来更长
  - 人物背向跑去 → 背部放大，腿部缩小

  ### 人物变形提示词模板

  **极端仰拍人物描述**：
  \`\`\`
  promptCn: "极端仰拍，[角色名]从下方仰视，下巴轮廓锋利突出，
            鼻孔隐约可见，肩膀呈宽大倒三角剪影，腿部透视缩短几乎不可见，
            垂直的身体线条向天空汇聚"
  promptEn: "(extreme low angle:1.4), [character] seen from below,
            (chin prominent:1.3), (nostrils faintly visible:1.2),
            (shoulders forming wide inverted triangle:1.3),
            (foreshortened legs:1.2), vertical lines converging upward"
  \`\`\`

  **极端俯拍/鸟瞰人物描述**：
  \`\`\`
  promptCn: "鸟瞰视角，[角色名]的头顶和肩膀轮廓清晰可见，
            背部弧线突出，脸部只见额头和头发，
            身体呈缩小的圆形剪影，地面细节占主导"
  promptEn: "(bird's eye view:1.4), [character] seen from above,
            (top of head and shoulders prominent:1.3),
            (back visible:1.2), (face foreshortened only forehead visible:1.2),
            figure diminished, ground details dominant"
  \`\`\`

  ================================================================================
  ## 💡 角度与光影配合规则（基于《Framed Perspective Vol.2》）

  ### 核心原则：光影方向必须与相机角度逻辑一致！

  | 相机角度 | 推荐光源 | 阴影位置 | 情绪效果 |
  |----------|---------|---------|---------|
  | **仰拍+顶光** | 顶光/背光 | 下巴下方深重阴影 | 威胁感、剪影效果 |
  | **仰拍+底光** | 底光 | 眼窝、额头阴影 | 恐怖、诡异 |
  | **俯拍+顶光** | 顶光 | 头顶亮、眼窝阴影 | 脆弱、被审视 |
  | **侧面+侧光** | 侧光 | 半明半暗 | 神秘、立体感 |
  | **逆光** | 背光 | 正面全黑剪影 | 威胁、神秘、史诗感 |

  ### 边缘光/轮廓光（Rim Light）

  背光照亮物体边缘，效果：
  - 将主体与背景分离
  - 创造发光的轮廓线
  - 增加三维立体感

  **轮廓光提示词**：
  \`\`\`
  promptCn: "背光轮廓光勾勒边缘，头发和肩膀发出金色光边"
  promptEn: "(rim light:1.3), (backlight:1.2), golden glow outlining hair and shoulders"
  \`\`\`

  ### 反射光（Reflected Light）

  从地面/墙壁反弹的光：
  - 软化阴影边界
  - 让黑暗区域不至于死黑
  - 特别适合雪地、水面、室内场景

  ================================================================================
  ## 🎬 动作拆解规范（复杂动作必须拆解！）

  复杂动作必须拆解为单一步骤，避免AI理解混乱：

  | 动作类型 | ❌ 错误写法 | ✅ 正确写法 |
  |---------|-----------|-----------|
  | 幅度控制 | 快速甩头 | 小幅度缓慢转动头部 |
  | 动作拆解 | 挥手 | 缓慢抬起小臂→手腕轻微转动→手掌张开 |
  | 肢体保护 | 跳舞 | 上半身轻微摆动，双手自然下垂 |
  | 起身动作 | 站起来 | 双手撑地→膝盖缓慢伸直→上身逐渐直立 |
  | 转身动作 | 转身 | 头部先转向目标方向→肩膀跟随转动→身体完成转向 |

  ================================================================================
  ## 💡 光影描述具象化规范（禁止抽象表述！）

  光影变化必须具象化描述，避免抽象表述：

  | ❌ 抽象写法 | ✅ 具象写法 |
  |-----------|-----------|
  | 光线变亮 | 晨光透过树叶在地面形成移动的光斑 |
  | 光线变暗 | 夕阳余晖从人物左肩缓慢移动至右肩 |
  | 灯光闪烁 | 台灯暖光逐渐照亮书页文字 |
  | 光影变化 | 侧光从左脸缓慢移动至右脸，阴影区域逐渐缩小 |
  | 氛围变冷 | 蓝色月光从窗外渗入，在地板上形成长方形光斑 |

  ================================================================================
  ## 👘 服装褶皱与动态规则（基于《Framed Perspective Vol.2》）

  ### 褶皱产生的四种力

  | 力的类型 | 产生位置 | 褶皱特征 | 示例 |
  |----------|----------|----------|------|
  | **重力** | 悬挂点 | 垂直向下的褶皱 | 披风、裙摆 |
  | **张力** | 拉伸点 | 从拉伸点向外辐射 | 弯曲的肘部、膝盖 |
  | **压缩** | 挤压点 | 密集的褶皱堆积 | 弯腰时的腰部 |
  | **扭转** | 旋转点 | 螺旋状褶皱 | 扭转的手臂 |

  ### 运动中的布料动态

  **规则**：
  - 布料向运动相反方向飘动
  - 运动越快，飘动越剧烈
  - 停止瞬间，布料会有"滞后"飘动

  **动态镜头提示词**：
  \`\`\`
  promptCn: "[角色]快速[奔跑/挥剑/跳跃]，[披风/衣袖/裙摆]向[后方/侧向]飘动，
            褶皱从[肩膀/腰部]向外辐射，形成流动的曲线"
  promptEn: "[character] rapidly [running/slashing/jumping],
            (cape billowing backward:1.3), (sleeves flowing:1.2),
            folds radiating from [shoulders/waist], creating flowing curves"
  \`\`\`

  ### 静态 vs 动态对比

  | 镜头类型 | 布料状态 | 描述方式 |
  |----------|---------|---------|
  | 静态/对话 | 布料自然下垂 | "披风垂落，轻微摆动" |
  | 行走 | 轻微飘动 | "衣摆轻轻摆动" |
  | 奔跑 | 明显飘动 | "披风向后飘动" |
  | 跳跃/战斗 | 剧烈飘动 | "披风剧烈翻飞，褶皱辐射" |

  - 禁止使用模糊描述，必须具体到方位和动作

  ## 输出要求
  - 所有描述使用中文自然语言，不使用【】：|等特殊符号
  - promptCn格式：景别(英文缩写)，视角高度(角度)，角色朝向(角度)。人物位置、姿态、表情、道具的自然语言描述。构图和光影描述。
  - endFramePromptCn格式与promptCn相同（运动镜头必填）
  - videoPromptCn 使用中文描述视频生成提示词
  - 提示词控制在800字以内，精炼浓缩
  - 返回纯JSON数组，不要markdown代码块

  ## 🚨🚨🚨 视频提示词七要素规范（所有镜头强制遵守！必须使用中文！）

  ### 🔴 强制规则：所有镜头都必须以"从首帧到尾帧"开头！
  无论是静态镜头、I2V模式还是Keyframe模式，videoGenPrompt都必须遵循统一格式！

  ### 核心公式（必须严格遵守！）
  \`\`\`
  "videoPromptCn": "从首帧到尾帧，[过渡方式] + [运镜方式] + [主体动作+运动轨迹] + [环境响应] + [光影过渡] + [速度节奏]，[时长]秒。"
  \`\`\`

  ### 七要素详解（每条都必须包含！缺一不可！）
  | 要素 | 说明 | 静态镜头示例 | 运动镜头示例 |
  |-----|------|------------|------------|
  | 1.过渡方式 | 明确变化类型 | 镜头固定 | 形态渐变/空间平移 |
  | 2.运镜方式 | 镜头运动 | 固定镜头 | 侧向跟拍/缓慢推进/环绕 |
  | 3.主体动作 | 拆分为步骤 | 保持静止姿态仅有轻微呼吸起伏 | 缓慢抬手→手腕转动→手掌张开 |
  | 4.运动轨迹 | 明确方向 | 身体微微前倾 | 从画面左侧向右侧移动 |
  | 5.环境响应 | 背景变化 | 背景光影微妙变化 | 苔藓随经过闪烁/花瓣飘落 |
  | 6.光影过渡 | 光线变化 | 侧光微妙变化在面部形成光影流动 | 从冷蓝调转为暖黄调 |
  | 7.速度节奏 | 量化控制 | 缓慢节奏 | 匀速/先慢后快/前3秒缓慢后2秒加速 |

  ### ⚠️ 字数要求
  - 最少50字，最多150字
  - 静态镜头通常50-80字
  - 运动镜头通常80-150字

  ### ✅ 正确示例（包含七要素）
  \`\`\`
  "videoPromptCn": "从首帧到尾帧，镜头侧向跟拍缓慢推进，两人在暗色生物管道中快速奔跑从画面左侧向右侧移动，脚步溅起蓝色电弧火花，管壁发光苔藓随经过明暗闪烁，光影从冷蓝调逐渐转为红蓝交织，先慢后快节奏，5秒。"
  \`\`\`

  ### ❌ 错误示例
  \`\`\`
  "videoPromptCn": "镜头侧向平移跟随两人全速奔跑，高速运动感，5秒。"
  // 问题：缺少过渡锚定、运动轨迹、环境响应、光影过渡
  \`\`\`

  ### 🚨 AI识别准确性规则（必须遵守！）
  | ❌ 禁止使用 | 问题 | ✅ 正确替换 |
  |-----------|------|-----------|
  | 动态剪影 | 太抽象 | 侧身轮廓/奔跑轮廓 |
  | 数据火花/数据碎片 | 太抽象 | 蓝色电弧火花/发光蓝色碎片 |
  | 更明显/更强烈 | 比较级 | 强烈的/浓烈的 |
  | 动态模糊/运动模糊 | 后期效果 | 带有速度感/衣角飘动 |
  | 全速奔跑/极度紧张 | 程度过度 | 快速奔跑/紧张专注 |

  ## ⚠️ 重要：提示词禁止包含美术风格！
  - promptCn, endFramePromptCn, videoPromptCn 中禁止出现以下内容：
    * "水墨", "线稿", "铅笔", "素描"
    * "水彩", "油画", "数字绘画"
    * "动漫风格", "漫画风格", "赛璐璐"
    * 任何其他美术风格描述
  - 提示词只描述画面内容、构图、光影，风格由用户在绘图阶段另行选择

  ================================================================================
  ## 🚨🚨🚨 最终自检（输出前必须执行！）

  在生成JSON数组之前，必须自检：

  ### 步骤1：数镜头数
  数一数你的JSON数组有多少个镜头对象？

  ### 步骤2：判断是否合格
  - 镜头数 >= 24 → ✅ 合格，输出
  - 镜头数 < 24 → ❌ 不合格！必须增加镜头！

  ### 步骤3：如果不合格，增加镜头
  从以下方式选择增加镜头：
  1. 为动作添加「准备→动作→效果」三步分解
  2. 添加「环境反应镜头」（如波纹扫过石柱）
  3. 添加「角色反应镜头」（如魔教教主惊恐）
  4. 添加「UI界面特写镜头」（如警告弹窗）
  5. 添加「氛围渲染镜头」（如天空裂开）

  ### ⚠️ 绝对禁止
  - 输出 < 20 个镜头 = 任务失败！
  - 每个剧本段落只有 1-2 个镜头 = 任务失败！

  ================================================================================
`;
}

# 角色信息修复验证测试指南

## 🎯 测试目标

验证下载的分镜剧本中能够正确显示角色信息，包括：
1. 本集角色信息部分（头部）
2. 每个镜头的出场角色名称

---

## 📋 测试步骤

### 步骤1：创建新项目或使用现有项目

1. 打开浏览器访问：http://localhost:5174/
2. 如果是新项目，点击"创建新项目"
3. 输入项目名称，上传剧本文件（或粘贴剧本文本）

---

### 步骤2：确保有角色数据

**方法A：使用默认角色**
- 系统默认包含两个角色：晋安（男）、林溪（女）
- 这两个角色已经有完整的外貌、性别等信息

**方法B：从剧本提取角色**
1. 在"剧本清洗"页面，点击"🔍 从剧本提取"按钮
2. AI会自动从剧本中提取角色信息
3. 等待提取完成，查看角色列表

**方法C：手动添加角色**
1. 在"角色设定"区域，输入角色名称
2. 选择性别（男/女/未知）
3. 输入外观描述
4. 点击"➕ 添加"按钮

---

### 步骤3：生成分镜脚本

1. 点击"下一步：生成分镜"
2. 选择生成模式（推荐"思维链生成"）
3. 点击"🎬 开始生成"按钮
4. 等待生成完成（约1-3分钟）

---

### 步骤4：为镜头分配角色

**重要：这是关键步骤！**

1. 在分镜表中，找到每个镜头的"角色"列
2. 点击角色名称（如"晋安"、"林溪"）来分配角色
3. 被选中的角色会高亮显示
4. 至少为2-3个镜头分配角色

**示例**：
- 镜头#001：分配"晋安"
- 镜头#002：分配"林溪"
- 镜头#003：分配"晋安"和"林溪"（可以多选）

---

### 步骤5：下载剧本并验证

1. 点击"📄 导出TXT"按钮
2. 下载 `storyboard_script.txt` 文件
3. 用文本编辑器打开文件

---

## ✅ 验证检查项

### 检查项1：头部角色信息

在文件开头应该看到：

```
╔═══════════════════════════════════════════════════════════════════╗
║                       本 集 角 色 信 息                           ║
╚═══════════════════════════════════════════════════════════════════╝

👤 晋安
   性别: 男
   外貌: 【外貌特征】浅棕色碎短发、发型蓬松有层次感...
   
👤 林溪
   性别: 女
   外貌: 【外貌特征】黑色长发（带有棕色渐变）...

═══════════════════════════════════════════════════════════════════
```

**✅ 通过条件**：
- 显示了所有在镜头中出场的角色
- 每个角色都有详细信息（性别、外貌等）
- 不再显示"（本集未标注角色信息）"

**❌ 失败条件**：
- 显示"（本集未标注角色信息）"
- 角色列表为空
- 角色信息不完整

---

### 检查项2：镜头中的角色信息

在每个分配了角色的镜头中应该看到：

```
═══════════════════════════════════════════════════════════════════
[#001] 3秒 | 静态 | 中景(MS)
═══════════════════════════════════════════════════════════════════

📖 故事: 晋安站在教室门口
💬 台词: "我来了。"

───────────────────────────────────────────────────────────────────
📐 角度: 3/4正面(3/4 Front) + 轻微仰拍(Mild Low)
🎬 运镜: 固定(Static)

🖼️ 构图:
   FG: 晋安站立
   MG: 教室门框
   BG: 走廊

💡 光影: 自然光从窗户照入
👥 角色: 晋安  ← 🆕 应该显示角色名称
```

**✅ 通过条件**：
- 每个分配了角色的镜头都显示"👥 角色: [角色名称]"
- 多个角色用"、"分隔（如"晋安、林溪"）
- 角色名称正确

**❌ 失败条件**：
- 没有显示"👥 角色"行
- 显示的是角色ID而不是名称
- 角色名称错误

---

## 🐛 如果测试失败

### 问题1：头部没有角色信息

**可能原因**：
- 没有为任何镜头分配角色
- 角色数据为空

**解决方案**：
1. 确认角色列表中有角色
2. 确认至少为1个镜头分配了角色
3. 重新下载剧本

---

### 问题2：镜头中没有角色名称

**可能原因**：
- 该镜头没有分配角色

**解决方案**：
1. 在分镜表中点击角色名称来分配
2. 确认角色被选中（高亮显示）
3. 重新下载剧本

---

## 📊 测试结果记录

| 检查项 | 预期结果 | 实际结果 | 状态 |
|--------|---------|---------|------|
| 头部显示角色信息 | 显示所有出场角色的详细信息 | ？ | ⬜ 待测试 |
| 镜头显示角色名称 | 显示"👥 角色: [名称]" | ？ | ⬜ 待测试 |
| 多角色显示 | 用"、"分隔多个角色 | ？ | ⬜ 待测试 |
| 角色信息完整性 | 包含性别、外貌等字段 | ？ | ⬜ 待测试 |

---

## 🎉 测试通过标准

所有以下条件都满足：
- ✅ 头部正确显示本集角色信息
- ✅ 每个镜头正确显示出场角色名称
- ✅ 不再显示"（本集未标注角色信息）"
- ✅ 角色信息完整（性别、外貌等）

---

**测试时间**: 2026-02-06  
**修复版本**: commit 7c85f92  
**测试人员**: [填写你的名字]

